(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin"),require("SegmentEditor")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin","SegmentEditor"],t):"object"===typeof exports?exports["CustomReports"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin"),require("SegmentEditor")):e["CustomReports"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"],e["SegmentEditor"])})("undefined"!==typeof self?self:this,(function(e,t,o,r){return function(e){var t={};function o(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(r,i,function(t){return e[t]}.bind(null,i));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="plugins/CustomReports/vue/dist/",o(o.s="fae3")}({"19dc":function(t,o){t.exports=e},"8bbf":function(e,o){e.exports=t},a5a2:function(e,t){e.exports=o},f06f:function(e,t){e.exports=r},fae3:function(e,t,o){"use strict";if(o.r(t),o.d(t,"ReportEdit",(function(){return Vt})),o.d(t,"ReportsList",(function(){return vo})),o.d(t,"ReportsManage",(function(){return Ro})),"undefined"!==typeof window){var r=window.document.currentScript,i=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(o.p=i[1])}var n=o("8bbf"),s={class:"loadingPiwik"},a=Object(n["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),l={class:"loadingPiwik"},c=Object(n["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),d={class:"alert alert-danger"},u={key:0},p={key:1},m={name:"name"},h={name:"description"},b={class:"form-group row"},v={class:"col s12"},f={class:"col s12 m6"},g={for:"all_websites",class:"siteSelectorLabel"},j={class:"sites_autocomplete"},O={class:"col s12 m6"},y={class:"form-help"},R={key:0,class:"inline-help"},S={key:1,class:"inline-help"},C={key:0,class:"col s12 m6"},N={key:0},E={for:"websitecontains"},k=Object(n["createElementVNode"])("br",null,null,-1),V=["placeholder"],w=["disabled","value"],_={key:1},D=Object(n["createElementVNode"])("br",null,null,-1),M={class:"entityTable"},A={class:"siteId"},I={class:"siteName"},U={key:0,class:"siteAction"},B={colspan:"3"},L={key:0,class:"siteAction"},T=["onClick"],P={class:"form-group row"},x={class:"col s12"},H={class:"unlockAlert alert alert-info"},G={key:0},q={key:1},F=Object(n["createElementVNode"])("br",null,null,-1),W=Object(n["createElementVNode"])("br",null,null,-1),z=["value"],Q={class:"alertUnlocked alert alert-warning"},Y={key:0},X={key:1},J={name:"reportType"},K={class:"form-group row"},Z={class:"col s12 m6 dimensionsGroup"},ee=Object(n["createElementVNode"])("br",null,null,-1),te={class:"groupValueSelect",name:"dimensions"},oe=["title","onClick"],re={class:"groupValueSelect addDimension",name:"dimensions"},ie={class:"col s12 m6"},ne={class:"form-help"},se={class:"inline-help"},ae={class:"form-group row"},le={class:"col s12 m6 metricsGroup"},ce=Object(n["createElementVNode"])("br",null,null,-1),de={class:"groupValueSelect",name:"metrics"},ue=["title","onClick"],pe={class:"groupValueSelect addMetric",name:"metrics"},me={class:"col s12 m6"},he={class:"form-help"},be={class:"inline-help"},ve=["innerHTML"],fe={class:"form-group row segmentFilterGroup"},ge={class:"col s12"},je={style:{margin:"8px 0",display:"inline-block"}},Oe={class:"form-group row"},ye={class:"col s12"},Re=Object(n["createElementVNode"])("br",null,null,-1),Se=Object(n["createElementVNode"])("br",null,null,-1),Ce={name:"reportCategories"},Ne={name:"reportSubcategories"},Ee={class:"alert alert-warning"},ke={key:0},Ve={key:1},we={class:"alert alert-danger"},_e={key:0},De={key:1},Me={key:0,class:"form-group row"},Ae=["textContent"],Ie={class:"col s12 m6"},Ue={id:"childReports",class:"col s12 m6"},Be=["data-id"],Le=Object(n["createElementVNode"])("span",{class:"ui-icon ui-icon-arrowthick-2-n-s"},null,-1),Te={class:"col s12 m6"},Pe={class:"form-help"},xe=["textContent"],He={class:"entityCancel"},Ge={class:"ui-confirm",id:"confirmUnlockReport",ref:"confirmUnlockReport"},qe={key:0},Fe={key:1},We=["value"],$e=["value"],ze={class:"ui-confirm",id:"infoReportIsLocked",ref:"infoReportIsLocked"},Qe={key:0},Ye={key:1},Xe=["value"],Je=["value"];function Ke(e,t,o,r,i,$){var Ke=Object(n["resolveComponent"])("Field"),Ze=Object(n["resolveComponent"])("SiteSelector"),et=Object(n["resolveComponent"])("SegmentGenerator"),tt=Object(n["resolveComponent"])("SaveButton"),ot=Object(n["resolveComponent"])("ContentBlock");return Object(n["openBlock"])(),Object(n["createBlock"])(ot,{class:"editReport","content-title":e.contentTitle},{default:Object(n["withCtx"])((function(){var o,r,i;return[Object(n["withDirectives"])(Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("span",s,[a,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[n["vShow"],e.isLoading]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("span",l,[c,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("CustomReports_UpdatingData")),1)])],512),[[n["vShow"],e.isUpdating]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",d,[e.multipleSites.length&&!e.report.allowedToEdit?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",u,Object(n["toDisplayString"])(e.translate("CustomReports_ReportEditNotAllowedMultipleWebsitesAccessIssue")),1)):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",p,Object(n["toDisplayString"])(e.translate("CustomReports_ReportEditNotAllowedAllWebsitesUpdated")),1))],512),[[n["vShow"],!e.canEdit]]),Object(n["createElementVNode"])("form",{onSubmit:t[15]||(t[15]=function(t){return e.edit?e.updateReport():e.createReport()})},[Object(n["createElementVNode"])("div",null,[Object(n["createElementVNode"])("div",m,[Object(n["createVNode"])(Ke,{uicontrol:"text",name:"name","model-value":e.report.name,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.report.name=t,e.setValueHasChanged()}),title:e.translate("General_Name"),maxlength:50,disabled:!e.canEdit,placeholder:e.translate("CustomReports_FieldNamePlaceholder"),"inline-help":e.translate("CustomReports_ReportNameHelp")},null,8,["model-value","title","disabled","placeholder","inline-help"])]),Object(n["createElementVNode"])("div",h,[Object(n["createVNode"])(Ke,{uicontrol:"textarea",name:"description","model-value":e.report.description,"onUpdate:modelValue":t[1]||(t[1]=function(t){e.report.description=t,e.setValueHasChanged()}),title:"".concat(e.translate("General_Description")," (optional)"),maxlength:1e3,disabled:!e.canEdit,rows:3,placeholder:e.translate("CustomReports_FieldDescriptionPlaceholder"),"inline-help":e.translate("CustomReports_ReportDescriptionHelp")},null,8,["model-value","title","disabled","placeholder","inline-help"])]),Object(n["createElementVNode"])("div",b,[Object(n["createElementVNode"])("h3",v,Object(n["toDisplayString"])(e.translate("CustomReports_ApplyTo")),1),Object(n["createElementVNode"])("div",f,[Object(n["createElementVNode"])("div",null,[Object(n["createElementVNode"])("label",g,Object(n["toDisplayString"])(e.translate("General_Website")),1),Object(n["createElementVNode"])("div",j,[Object(n["createVNode"])(Ze,{id:"all_websites","model-value":e.report.site,"onUpdate:modelValue":t[2]||(t[2]=function(t){e.report.site=t,e.setWebsiteChanged(t)}),"show-all-sites-item":e.isSuperUser,"switch-site-on-select":!1,"show-selected-site":!0},null,8,["model-value","show-all-sites-item"])])])]),Object(n["createElementVNode"])("div",O,[Object(n["createElementVNode"])("div",y,[e.isSuperUser?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",R,Object(n["toDisplayString"])(e.translate("CustomReports_ReportAllWebsitesHelp")),1)):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",S,Object(n["toDisplayString"])(e.translate("CustomReports_ReportAllWebsitesNonSuperUserHelp")),1))])]),"all"!==e.report.site.id&&"0"!==e.report.site.id&&0!==e.report.site.id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",C,[e.report.allowedToEdit?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",N,[Object(n["createElementVNode"])("span",E,Object(n["toDisplayString"])(e.translate("CustomReports_SelectMeasurablesMatchingSearch")),1),k,Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{class:"control_text customReportSearchMeasurablesField",type:"text",id:"websitecontains","onUpdate:modelValue":t[3]||(t[3]=function(t){return e.containsText=t}),placeholder:e.translate("General_Search")},null,8,V),[[n["vModelText"],e.containsText]]),Object(n["createElementVNode"])("input",{style:{"margin-left":"3.5px"},disabled:!e.containsText,class:"btn customReportSearchFindMeasurables",type:"button",onClick:t[4]||(t[4]=function(t){return e.addSitesContaining(e.containsText)}),value:e.translate("CustomReports_FindMeasurables")},null,8,w)])):Object(n["createCommentVNode"])("",!0),e.report.allowedToEdit||e.multipleSites.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",_,[D,Object(n["createElementVNode"])("table",M,[Object(n["createElementVNode"])("thead",null,[Object(n["createElementVNode"])("tr",null,[Object(n["createElementVNode"])("th",A,Object(n["toDisplayString"])(e.translate("General_Id")),1),Object(n["createElementVNode"])("th",I,Object(n["toDisplayString"])(e.translate("General_Name")),1),e.report.allowedToEdit?(Object(n["openBlock"])(),Object(n["createElementBlock"])("th",U,Object(n["toDisplayString"])(e.translate("General_Remove")),1)):Object(n["createCommentVNode"])("",!0)])]),Object(n["createElementVNode"])("tbody",null,[Object(n["withDirectives"])(Object(n["createElementVNode"])("tr",null,[Object(n["createElementVNode"])("td",B,Object(n["toDisplayString"])(e.translate("CustomReports_NoMeasurableAssignedYet")),1)],512),[[n["vShow"],!e.multipleSites.length]]),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.multipleSites,(function(t,o){return Object(n["withDirectives"])((Object(n["openBlock"])(),Object(n["createElementBlock"])("tr",{key:o},[Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(t.idsite),1),Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(t.name),1),e.report.allowedToEdit?(Object(n["openBlock"])(),Object(n["createElementBlock"])("td",L,[Object(n["createElementVNode"])("span",{class:"icon-minus table-action",onClick:function(o){return e.removeSite(t)}},null,8,T)])):Object(n["createCommentVNode"])("",!0)],512)),[[n["vShow"],e.multipleSites.length>0]])})),128))])])])):Object(n["createCommentVNode"])("",!0)])):Object(n["createCommentVNode"])("",!0)]),Object(n["createElementVNode"])("div",P,[Object(n["createElementVNode"])("h3",x,Object(n["toDisplayString"])(e.translate("CustomReports_ReportContent")),1)]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",H,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",G,Object(n["toDisplayString"])(e.translate("CustomReports_WarningRequiresUnlockBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(n["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",q,Object(n["toDisplayString"])(e.translate("CustomReports_WarningRequiresUnlock")),1)),F,W,Object(n["createElementVNode"])("input",{type:"button",class:"btn unlockReport",onClick:t[5]||(t[5]=function(t){return e.unlockReport()}),value:e.translate("CustomReports_Unlock")},null,8,z)],512),[[n["vShow"],e.isLocked]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",Q,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",Y,Object(n["toDisplayString"])(e.translate("CustomReports_WarningOnUpdateReportMightGetLostBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(n["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",X,Object(n["toDisplayString"])(e.translate("CustomReports_WarningOnUpdateReportMightGetLost")),1))],512),[[n["vShow"],e.isUnlocked]]),Object(n["createElementVNode"])("div",J,[Object(n["createVNode"])(Ke,{uicontrol:"radio",name:"reportType","model-value":e.report.report_type,"onUpdate:modelValue":t[6]||(t[6]=function(t){return e.setReportTypeHasChanged(t)}),title:e.translate("CustomReports_ReportType"),disabled:!e.canEdit,options:e.reportTypes},null,8,["model-value","title","disabled","options"])]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",K,[Object(n["createElementVNode"])("div",Z,[Object(n["createElementVNode"])("label",null,Object(n["toDisplayString"])(e.translate("CustomReports_Dimensions")),1),ee,Object(n["createElementVNode"])("div",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.report.dimensions,(function(t,o){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{class:Object(n["normalizeClass"])("selectedDimension selectedDimension".concat(o)),key:o},[Object(n["createElementVNode"])("div",te,[Object(n["createVNode"])(Ke,{uicontrol:"expandable-select",name:"dimensions","model-value":t,"onUpdate:modelValue":function(t){return e.changeDimension(t,o)},title:e.dimensionsReadable[t]||t,"full-width":!0,options:e.dimensions},null,8,["model-value","onUpdate:modelValue","title","options"])]),Object(n["createElementVNode"])("span",{class:"icon-minus",title:e.translate("CustomReports_RemoveDimension"),onClick:function(t){return e.removeDimension(o)}},null,8,oe)],2)})),128)),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",re,[Object(n["createVNode"])(Ke,{uicontrol:"expandable-select",name:"dimensions","model-value":"","onUpdate:modelValue":t[7]||(t[7]=function(t){e.addDimension(t)}),title:e.translate("CustomReports_AddDimension"),"full-width":!0,options:e.dimensions},null,8,["title","options"])],512),[[n["vShow"],e.report.dimensions.length<=2]])])]),Object(n["createElementVNode"])("div",ie,[Object(n["createElementVNode"])("div",ne,[Object(n["createElementVNode"])("span",se,Object(n["toDisplayString"])(e.translate("CustomReports_ReportDimensionsHelp")),1)])])],512),[[n["vShow"],"evolution"!==e.report.report_type]]),Object(n["createElementVNode"])("div",ae,[Object(n["createElementVNode"])("div",le,[Object(n["createElementVNode"])("label",null,Object(n["toDisplayString"])(e.translate("General_Metrics")),1),ce,Object(n["createElementVNode"])("div",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.report.metrics,(function(t,o){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{class:Object(n["normalizeClass"])("selectedMetric selectedMetric".concat(o)),key:o},[Object(n["createElementVNode"])("div",de,[Object(n["createVNode"])(Ke,{uicontrol:"expandable-select",name:"metrics","model-value":t,"onUpdate:modelValue":function(t){return e.changeMetric(t,o)},title:e.metricsReadable[t]||t,"full-width":!0,options:e.metrics},null,8,["model-value","onUpdate:modelValue","title","options"])]),Object(n["createElementVNode"])("span",{class:"icon-minus",title:e.translate("CustomReports_RemoveMetric"),onClick:function(t){return e.removeMetric(o)}},null,8,ue)],2)})),128)),Object(n["createElementVNode"])("div",pe,[Object(n["createVNode"])(Ke,{uicontrol:"expandable-select",name:"metrics","model-value":"","onUpdate:modelValue":t[8]||(t[8]=function(t){e.addMetric(t)}),title:e.translate("CustomReports_AddMetric"),"full-width":!0,options:e.metrics},null,8,["title","options"])])])]),Object(n["createElementVNode"])("div",me,[Object(n["createElementVNode"])("div",he,[Object(n["createElementVNode"])("span",be,Object(n["toDisplayString"])(e.translate("CustomReports_ReportMetricsHelp")),1)])])]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",{class:"alert alert-warning",innerHTML:e.getProductRevenueDependencyMessage},null,8,ve),[[n["vShow"],e.dependencyAdded]]),Object(n["createElementVNode"])("div",fe,[Object(n["createElementVNode"])("div",ge,[Object(n["createElementVNode"])("div",null,[Object(n["createElementVNode"])("label",je,Object(n["toDisplayString"])(e.translate("CustomReports_Filter")),1),Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(e.translate("CustomReports_ReportSegmentHelp")),1),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(et,{"model-value":e.report.segment_filter,"onUpdate:modelValue":t[9]||(t[9]=function(t){return e.setSegmentFilterHasChanged(t)}),idsite:e.report.site.id},null,8,["model-value","idsite"])])])])]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",Oe,[Object(n["createElementVNode"])("div",ye,[Re,Se,Object(n["createVNode"])(tt,{class:"showPreviewButton",disabled:!(null!==(o=e.report.metrics)&&void 0!==o&&o.length)||!(null!==(r=e.report.dimensions)&&void 0!==r&&r.length),onConfirm:t[10]||(t[10]=function(t){return e.showPreview()}),value:e.translate("CustomReports_PreviewReport")},null,8,["disabled","value"])])],512),[[n["vShow"],"table"===e.report.report_type]]),Object(n["createElementVNode"])("div",Ce,[Object(n["createVNode"])(Ke,{uicontrol:"select",name:"reportCategories","model-value":e.report.category.id,"onUpdate:modelValue":t[11]||(t[11]=function(t){e.report.category.id=t,e.setValueHasChanged()}),title:e.translate("CustomReports_ReportCategory"),disabled:!e.canEdit,options:e.categories,introduction:e.translate("CustomReports_ReportPage"),"inline-help":e.translate("CustomReports_ReportCategoryHelp")},null,8,["model-value","title","disabled","options","introduction","inline-help"])]),Object(n["createElementVNode"])("div",Ne,[Object(n["createVNode"])(Ke,{uicontrol:"select",name:"reportSubcategories","model-value":null===(i=e.report.subcategory)||void 0===i?void 0:i.id,"onUpdate:modelValue":t[12]||(t[12]=function(t){e.setSubcategory(t),e.setValueHasChanged()}),title:e.translate("CustomReports_ReportSubcategory"),disabled:!e.canEdit,options:e.subcategories[e.report.category.id],"inline-help":e.translate("CustomReports_ReportSubcategoryHelp")},null,8,["model-value","title","disabled","options","inline-help"])]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",Ee,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",ke,Object(n["toDisplayString"])(e.translate("CustomReports_WarningOnUpdateReportMightGetLostBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(n["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",Ve,Object(n["toDisplayString"])(e.translate("CustomReports_WarningOnUpdateReportMightGetLost")),1))],512),[[n["vShow"],e.isUnlocked]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",we,[e.multipleSites.length&&!e.report.allowedToEdit?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",_e,Object(n["toDisplayString"])(e.translate("CustomReports_ReportEditNotAllowedMultipleWebsitesAccessIssue")),1)):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",De,Object(n["toDisplayString"])(e.translate("CustomReports_ReportEditNotAllowedAllWebsitesUpdated")),1))],512),[[n["vShow"],!e.canEdit]]),e.childReports.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Me,[Object(n["createElementVNode"])("h3",{class:"col s12",textContent:Object(n["toDisplayString"])(e.translate("CustomReports_OrderSubCategoryReports"))},null,8,Ae),Object(n["createElementVNode"])("div",Ie,[Object(n["createElementVNode"])("ul",Ue,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.childReports,(function(e){return Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:e.idcustomreport,"data-id":e.idcustomreport},[Le,Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.name),1)],8,Be)})),128))])]),Object(n["createElementVNode"])("div",Te,[Object(n["createElementVNode"])("div",Pe,[Object(n["createElementVNode"])("div",{class:"form-description",textContent:Object(n["toDisplayString"])(e.translate("CustomReports_OrderSubCategoryReportsDescription"))},null,8,xe)])])])):Object(n["createCommentVNode"])("",!0),Object(n["withDirectives"])(Object(n["createVNode"])(tt,{class:"createButton",onConfirm:t[13]||(t[13]=function(t){return e.edit?e.updateReport():e.createReport()}),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.saveButtonText},null,8,["disabled","saving","value"]),[[n["vShow"],e.canEdit]]),Object(n["createElementVNode"])("div",He,[Object(n["createElementVNode"])("a",{onClick:t[14]||(t[14]=function(t){return e.cancel()})},Object(n["toDisplayString"])(e.translate("General_Cancel")),1)])])],32),Object(n["createElementVNode"])("div",Ge,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(n["openBlock"])(),Object(n["createElementBlock"])("h2",qe,Object(n["toDisplayString"])(e.translate("CustomReports_ConfirmUnlockReportBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(n["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("h2",Fe,Object(n["toDisplayString"])(e.translate("CustomReports_ConfirmUnlockReport")),1)),Object(n["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,We),Object(n["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,$e)],512),Object(n["createElementVNode"])("div",ze,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(n["openBlock"])(),Object(n["createElementBlock"])("h2",Qe,Object(n["toDisplayString"])(e.translate("CustomReports_InfoReportIsLockedBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(n["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("h2",Ye,Object(n["toDisplayString"])(e.translate("CustomReports_InfoReportIsLocked")),1)),Object(n["createElementVNode"])("input",{role:"unlock",type:"button",value:e.translate("CustomReports_Unlock")},null,8,Xe),Object(n["createElementVNode"])("input",{role:"ok",type:"button",value:e.translate("General_Cancel")},null,8,Je)],512)]})),_:1},8,["content-title"])}var Ze=o("19dc"),et=o("a5a2"),tt=o("f06f");function ot(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function rt(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function it(e,t,o){return t&&rt(e.prototype,t),o&&rt(e,o),e}function nt(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function st(e){return dt(e)||ct(e)||lt(e)||at()}function at(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function lt(e,t){if(e){if("string"===typeof e)return ut(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?ut(e,t):void 0}}function ct(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function dt(e){if(Array.isArray(e))return ut(e)}function ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}
/**
 * Copyright (C) InnoCraft Ltd - All rights reserved.
 *
 * NOTICE:  All information contained herein is, and remains the property of InnoCraft Ltd.
 * The intellectual and technical concepts contained herein are protected by trade secret
 * or copyright law. Redistribution of this information or reproduction of this material is
 * strictly forbidden unless prior written permission is obtained from InnoCraft Ltd.
 *
 * You shall use this code only in accordance with the license agreement obtained from
 * InnoCraft Ltd.
 *
 * @link https://www.innocraft.com/
 * @license For license details see https://www.innocraft.com/license
 */function pt(e){return st(new Set(e)).filter((function(e){return!!e}))}function mt(e,t,o){var r=[];return e.forEach((function(e){e[t].forEach((function(t){r.push(Object.assign({group:e.category,key:t.uniqueId,value:t.name,tooltip:t.description||void 0},o?nt({},o,t[o]):{}))}))})),r}var ht={key:"",value:""},bt=function(){function e(){var t=this;ot(this,e),nt(this,"privateState",Object(n["reactive"])({reports:[],reportTypesReadable:{},dimensionsReadable:{},metricsReadable:{},categories:[],subcategories:{},isLoading:!1,isUpdating:!1,allMetrics:[],allDimensions:[]})),nt(this,"state",Object(n["computed"])((function(){return Object(n["readonly"])(t.privateState)}))),nt(this,"fetchPromise",null),nt(this,"availableReportTypesPromise",null),nt(this,"dimensionsPromise",null),nt(this,"dimensionsIdsiteLoaded",0),nt(this,"metricsPromise",null),nt(this,"metricsIdsiteLoaded",0),nt(this,"categoriesPromise",null),nt(this,"categoriesIdsiteLoaded",null)}return it(e,[{key:"reload",value:function(){return this.privateState.reports=[],this.fetchPromise=null,this.fetchReports()}},{key:"cleanupSegmentDefinition",value:function(e){var t=e;return t=t.replace("'","%27"),t=t.replace("&","%26"),t}},{key:"getAvailableReportTypes",value:function(){var e=this;return this.availableReportTypesPromise||(this.availableReportTypesPromise=Ze["AjaxHelper"].fetch({method:"CustomReports.getAvailableReportTypes",filter_limit:"-1"}).then((function(t){var o={};t.forEach((function(e){o[e.key]=e.value})),e.privateState.reportTypesReadable=o}))),this.availableReportTypesPromise.then((function(){return e.state.value.reportTypesReadable}))}},{key:"getAvailableDimensions",value:function(e){var t=this;return this.dimensionsPromise&&this.dimensionsIdsiteLoaded===e||(this.dimensionsIdsiteLoaded=e,this.dimensionsPromise=Ze["AjaxHelper"].fetch({method:"CustomReports.getAvailableDimensions",filter_limit:"-1",idSite:e}).then((function(e){var o={};e.forEach((function(e){e.dimensions.forEach((function(e){o[e.uniqueId]=e.name}))})),t.privateState.dimensionsReadable=o,t.privateState.allDimensions=mt(e,"dimensions","sqlSegment")}))),this.dimensionsPromise.then((function(){return t.state.value.dimensionsReadable}))}},{key:"getAvailableMetrics",value:function(e){var t=this;return this.metricsPromise&&this.metricsIdsiteLoaded===e||(this.metricsIdsiteLoaded=e,this.metricsPromise=Ze["AjaxHelper"].fetch({method:"CustomReports.getAvailableMetrics",filter_limit:"-1",idSite:e}).then((function(e){var o={};e.forEach((function(e){e.metrics.forEach((function(e){o[e.uniqueId]=e.name}))})),t.privateState.metricsReadable=o,t.privateState.allMetrics=mt(e,"metrics")}))),this.metricsPromise.then((function(){return t.state.value.metricsReadable}))}},{key:"getAvailableCategories",value:function(e){var t=this,o=e&&"all"!==e?e:Ze["Matomo"].idSite;return this.categoriesPromise&&this.categoriesIdsiteLoaded===e||(this.categoriesPromise=Ze["AjaxHelper"].fetch({method:"CustomReports.getAvailableCategories",filter_limit:"-1",idSite:o}).then((function(e){var o=[],r={};e.forEach((function(e){o.push({key:e.uniqueId,value:e.name}),e.subcategories.forEach((function(t){r[e.uniqueId]=r[e.uniqueId]||[ht],r[e.uniqueId].push({key:t.uniqueId,value:t.name})}))})),t.privateState.categories=o,t.privateState.subcategories=r}))),this.categoriesPromise}},{key:"fetchReports",value:function(){var e=this;return this.fetchPromise||(this.fetchPromise=Ze["AjaxHelper"].fetch({method:"CustomReports.getConfiguredReports",filter_limit:"-1"})),this.privateState.isLoading=!0,this.privateState.reports=[],this.fetchPromise.then((function(t){return e.privateState.reports=t.map((function(e){var t,o,r=void 0;return r=null!==e&&void 0!==e&&null!==(t=e.subcategory)&&void 0!==t&&t.id?e.subcategory.id:"CustomReports_CustomReports"===(null===e||void 0===e||null===(o=e.category)||void 0===o?void 0:o.id)?e.idcustomreport:e.name,Object.assign(Object.assign({},e),{},{linkIdSite:e.idsite?e.idsite:Ze["Matomo"].idSite,subcategoryLink:r})})),e.state.value.reports})).finally((function(){e.privateState.isLoading=!1}))}},{key:"findReport",value:function(e,t){var o=this,r=this.state.value.reports.find((function(t){return parseInt("".concat(t.idcustomreport),10)===e}));return r&&!t?Promise.resolve(r):(this.privateState.isLoading=!0,Ze["AjaxHelper"].fetch({idCustomReport:e,method:"CustomReports.getConfiguredReport"}).finally((function(){o.privateState.isLoading=!1})))}},{key:"deleteReport",value:function(e,t){var o=this;return this.privateState.isUpdating=!0,this.privateState.reports=[],Ze["AjaxHelper"].fetch({idCustomReport:e,idSite:"".concat(t),method:"CustomReports.deleteCustomReport"},{withTokenInUrl:!0}).then((function(){return{type:"success"}})).catch((function(e){return{type:"error",message:e.message||e}})).finally((function(){o.privateState.isUpdating=!1}))}},{key:"createOrUpdateReport",value:function(e,t,o,r){var i,n,s=this;return this.privateState.isUpdating=!0,Ze["AjaxHelper"].post({method:t,idCustomReport:e.idcustomreport,reportType:e.report_type,name:e.name.trim(),description:e.description.trim(),segmentFilter:encodeURIComponent(e.segment_filter),categoryId:null===(i=e.category)||void 0===i?void 0:i.id,subcategoryId:null===(n=e.subcategory)||void 0===n?void 0:n.id,idSite:e.site.id,subCategoryReportIds:o,multipleIdSites:r},{dimensionIds:pt(e.dimensions),metricIds:pt(e.metrics)},{withTokenInUrl:!0}).then((function(e){return{type:"success",response:e}})).catch((function(e){return{type:"error",message:e.message||e}})).finally((function(){s.privateState.isUpdating=!1}))}}]),e}(),vt=new bt;function ft(e){return yt(e)||Ot(e)||jt(e)||gt()}function gt(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function jt(e,t){if(e){if("string"===typeof e)return Rt(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?Rt(e,t):void 0}}function Ot(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function yt(e){if(Array.isArray(e))return Rt(e)}function Rt(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var St="reportsmanagement",Ct="reportsmanagementProductMetric";function Nt(e){return ft(new Set(e)).filter((function(e){return!!e}))}function Et(){return{dimensions:[],site:{id:Ze["Matomo"].idSite,name:Ze["Matomo"].currentSiteName},category:{}}}var kt=Object(n["defineComponent"])({props:{idCustomReport:Number,browserArchivingDisabled:Boolean,reArchiveLastN:Number},components:{ContentBlock:Ze["ContentBlock"],Field:et["Field"],SiteSelector:Ze["SiteSelector"],SegmentGenerator:tt["SegmentGenerator"],SaveButton:et["SaveButton"]},data:function(){return{isDirty:!1,report:Et(),isLocked:!1,isUnlocked:!1,canEdit:!0,dependencyAdded:!1,childReports:[],childReportIds:[],containsText:"",multipleSites:[],multipleIdSites:[]}},created:function(){vt.getAvailableReportTypes(),this.init()},watch:{idCustomReport:function(e){null!==e&&this.init()}},methods:{initReportOptions:function(){var e=parseInt("".concat(this.report.site.id),10)||"all";vt.getAvailableDimensions(e),vt.getAvailableMetrics(e),vt.getAvailableCategories(e)},doUnlock:function(){this.isLocked=!1,this.isUnlocked=!0},confirmReportIsLocked:function(e){var t=this;Ze["Matomo"].helper.modalConfirm(this.$refs.infoReportIsLocked,{unlock:function(){t.doUnlock(),e&&e()}})},removeAnyReportNotification:function(){Ze["NotificationsStore"].remove(St),Ze["NotificationsStore"].remove(Ct),Ze["NotificationsStore"].remove("ajaxHelper")},showNotification:function(e,t){var o=Ze["NotificationsStore"].show({message:e,context:t,id:St,type:"transient",prepend:!0});setTimeout((function(){Ze["NotificationsStore"].scrollToNotification(o)}),100)},showProductMetricNotification:function(e,t){var o=Ze["NotificationsStore"].show({message:e,context:"warning",id:Ct,type:"transient"});t&&setTimeout((function(){Ze["NotificationsStore"].scrollToNotification(o)}),100)},showErrorFieldNotProvidedNotification:function(e){var t=Object(Ze["translate"])("CustomReports_ErrorXNotProvided",[e]);this.showNotification(t,"error")},init:function(){var e=this,t=this.idCustomReport;this.canEdit=!0,this.report=Et(),Ze["Matomo"].helper.lazyScrollToContent(),this.edit&&t?vt.findReport(t,!0).then((function(t){var o;if(t){e.report=Object(Ze["clone"])(t),e.isLocked=!0,e.isUnlocked=!1,e.canEdit=!0,e.childReports=null!==(o=e.report.child_reports)&&void 0!==o?o:[],e.report.multipleIdSites&&e.report.multipleIdSites.length&&"all"!==e.report.site.id&&"0"!==e.report.site.id&&0!==e.report.site.id&&(e.multipleSites=e.report.multipleIdSites,e.report.allowedToEdit||(e.canEdit=!1,e.isLocked=!1)),e.childReports.length&&Object.values(e.childReports).forEach((function(t){e.childReportIds.push(t.idcustomreport)})),$(document).ready((function(){$("#childReports").sortable({connectWith:"#childReports",update:function(){e.isDirty=!0;var t=$("#childReports li");e.childReportIds=[],t.each((function(t,o){o.dataset.id&&e.childReportIds.push(o.dataset.id)}))}})}));var r=e.report.idsite;0!==r&&"0"!==r&&"all"!==r||(r="all",e.isSuperUser||(e.canEdit=!1,e.isLocked=!1)),e.report.site={id:r,name:e.report.site.name},e.isDirty=!1,e.initReportOptions()}})):this.create&&(this.report={idsite:Ze["Matomo"].idSite,site:{id:Ze["Matomo"].idSite,name:Ze["Matomo"].currentSiteName||Ze["Matomo"].siteName},name:"",description:"",dimensions:[],metrics:["nb_visits"],report_type:"table",category:{id:"CustomReports_CustomReports"},subcategory:null,segment_filter:"",child_reports:[],allowedToEdit:!0},this.isLocked=!1,this.canEdit=!0,this.isDirty=!1,this.initReportOptions())},cancel:function(){var e=Object.assign({},Ze["MatomoUrl"].hashParsed.value);delete e.idCustomReport,Ze["MatomoUrl"].updateHash(e)},unlockReport:function(){var e=this;this.report&&this.isLocked&&Ze["Matomo"].helper.modalConfirm(this.$refs.confirmUnlockReport,{yes:function(){e.doUnlock()}})},createReport:function(){var e=this,t="CustomReports.addCustomReport";this.removeAnyReportNotification(),this.checkRequiredFieldsAreSet()&&(this.multipleIdSites=[],this.multipleSites&&this.multipleSites.length&&"all"!==this.report.site.id&&"0"!==this.report.site.id&&0!==this.report.site.id&&(this.multipleIdSites.push(Ze["Matomo"].idSite),this.multipleSites.forEach((function(t){var o=t.idsite;e.multipleIdSites.includes(o)||e.multipleIdSites.push(o)}))),this.multipleIdSites&&this.multipleIdSites.length&&(this.report.site.id=Ze["Matomo"].idSite),vt.createOrUpdateReport(this.report,t,this.childReportIds,this.multipleIdSites).then((function(t){if(t&&"error"!==t.type&&t.response){e.isDirty=!1;var o=t.response.value;if(e.report.site){var r=e.report.site.id;if(r&&"all"!==r&&"".concat(r)!=="".concat(Ze["Matomo"].idSite))return void Ze["MatomoUrl"].updateUrl(Object.assign(Object.assign({},Ze["MatomoUrl"].urlParsed.value),{},{idSite:r}),Object.assign(Object.assign({},Ze["MatomoUrl"].hashParsed.value),{},{idCustomReport:o}))}vt.reload().then((function(){Ze["Matomo"].helper.isReportingPage()&&Ze["Matomo"].postEvent("updateReportingMenu"),Ze["MatomoUrl"].updateHash(Object.assign(Object.assign({},Ze["MatomoUrl"].hashParsed.value),{},{idCustomReport:o})),setTimeout((function(){e.showNotification(Object(Ze["translate"])("CustomReports_ReportCreated"),t.type)}),200)}))}})))},showPreview:function(){var e,t,o;if(this.isProductRevenueDependencyMet(!0)){var r=null!==(e=this.report.site)&&void 0!==e&&e.id&&"all"!==this.report.site.id?this.report.site.id:Ze["Matomo"].idSite,i=(null===(t=this.report.dimensions)||void 0===t?void 0:t.length)&&this.report.report_type&&"evolution"!==this.report.report_type,n=i?this.report.dimensions.join(","):void 0,s=!(null===(o=this.report.metrics)||void 0===o||!o.length),a=s?this.report.metrics.join(","):void 0,l=Ze["MatomoUrl"].stringify({module:"CustomReports",action:"previewReport",period:"day",date:"today",idSite:r,report_type:this.report.report_type,dimensions:n,metrics:a,segment:this.report.segment_filter||void 0}),c=Object(Ze["translate"])("CustomReports_Preview");window.Piwik_Popover.createPopupAndLoadUrl(l,c,"customReportPreview")}},setValueHasChanged:function(){this.isDirty=!0},addDimension:function(e){var t=this;this.report&&e&&(this.isLocked?this.confirmReportIsLocked((function(){t.addDimension(e)})):(this.report.dimensions||(this.report.dimensions=[]),this.report.dimensions=[].concat(ft(this.report.dimensions),[e]),this.setValueHasChanged()))},changeDimension:function(e,t){var o,r=this;this.report&&e&&(this.isLocked?this.confirmReportIsLocked((function(){r.changeDimension(e,t)})):null!==(o=this.report.dimensions)&&void 0!==o&&o[t]&&(this.report.dimensions=ft(this.report.dimensions),this.report.dimensions[t]=e,this.setValueHasChanged()))},changeMetric:function(e,t){var o,r=this;this.dependencyAdded=!1,this.report&&e&&(this.isLocked?this.confirmReportIsLocked((function(){r.changeMetric(e,t)})):null!==(o=this.report.metrics)&&void 0!==o&&o[t]&&(this.report.metrics=ft(this.report.metrics),this.report.metrics[t]=e,this.setValueHasChanged(),this.addMetricIfMissingDependency(e)))},setWebsiteChanged:function(e){this.setValueHasChanged(),this.initReportOptions(),"all"===this.report.site.id||"0"===this.report.site.id||0===this.report.site.id?this.multipleSites=[]:this.report.allowedToEdit&&!this.isSiteIncludedAlready("".concat(e.id))&&this.multipleSites&&this.multipleSites.push({idsite:e.id,name:e.name})},removeDimension:function(e){var t=this;this.isLocked?this.confirmReportIsLocked((function(){t.removeDimension(e)})):(window.$('div.ui-tooltip[role="tooltip"]:not([style*="display: none"])').remove(),e>-1&&(this.report.dimensions=ft(this.report.dimensions),this.report.dimensions.splice(e,1),this.setValueHasChanged()))},addMetric:function(e){var t=this;this.dependencyAdded=!1,this.report&&e&&(this.report.metrics||(this.report.metrics=[]),this.isLocked?this.confirmReportIsLocked((function(){t.addMetric(e)})):(this.report.metrics=[].concat(ft(this.report.metrics),[e]),this.setValueHasChanged(),this.addMetricIfMissingDependency(e)))},addMetricIfMissingDependency:function(e){if(["sum_product_revenue","avg_product_revenue"].includes(e)&&!this.doesReportIncludeProductQuantityMetric()){var t="avg_product_revenue"===e?"avg_ecommerce_productquantity":"sum_ecommerce_productquantity";this.addMetric(t),this.dependencyAdded=!0}},removeMetric:function(e){var t=this;this.dependencyAdded=!1,this.isLocked?this.confirmReportIsLocked((function(){t.removeMetric(e)})):(window.$('div.ui-tooltip[role="tooltip"]:not([style*="display: none"])').remove(),e>-1&&(this.report.metrics=ft(this.report.metrics),this.report.metrics.splice(e,1),this.setValueHasChanged()))},setReportTypeHasChanged:function(e){var t=this;this.report&&this.isLocked?e!==this.report.report_type&&this.confirmReportIsLocked((function(){t.report.report_type=e,t.setValueHasChanged()})):(this.report.report_type=e,this.setValueHasChanged())},setSegmentFilterHasChanged:function(e){var t=this;this.report&&this.isLocked?e!==this.report.segment_filter&&this.confirmReportIsLocked((function(){t.report.segment_filter=e,t.setValueHasChanged()})):(this.report.segment_filter=e,this.setValueHasChanged())},updateReport:function(){var e=this;if(this.removeAnyReportNotification(),this.checkRequiredFieldsAreSet()){this.multipleIdSites=[],this.multipleSites&&this.multipleSites.length&&"all"!==this.report.site.id&&"0"!==this.report.site.id&&0!==this.report.site.id&&(this.multipleIdSites.push(Ze["Matomo"].idSite),this.multipleSites.forEach((function(t){var o=t.idsite;e.multipleIdSites.includes(o)||e.multipleIdSites.push(o)})));var t="CustomReports.updateCustomReport";this.multipleIdSites&&this.multipleIdSites.length&&(this.report.site.id=Ze["Matomo"].idSite),vt.createOrUpdateReport(this.report,t,this.childReportIds,this.multipleIdSites).then((function(t){if(t&&"error"!==t.type){var o=e.report.site.id;e.isDirty=!1,e.canEdit=!0,o&&"all"!==o&&"".concat(o)!=="".concat(Ze["Matomo"].idSite)?Ze["MatomoUrl"].updateUrl(Object.assign(Object.assign({},Ze["MatomoUrl"].urlParsed.value),{},{idSite:o}),Object.assign({},Ze["MatomoUrl"].hashParsed.value)):(vt.reload().then((function(){e.init()})),e.showNotification(Object(Ze["translate"])("CustomReports_ReportUpdated"),t.type))}}))}},checkRequiredFieldsAreSet:function(){var e,t;if(!this.report.name){var o=Object(Ze["translate"])("General_Name");return this.showErrorFieldNotProvidedNotification(o),!1}if("evolution"!==this.report.report_type&&(null===(t=this.report.dimensions)||void 0===t||!t.length||!Nt(this.report.dimensions).length)){var r=Object(Ze["translate"])("CustomReports_ErrorMissingDimension");return this.showNotification(r,"error"),!1}if(null===(e=this.report.metrics)||void 0===e||!e.length||!Nt(this.report.metrics).length){var i=Object(Ze["translate"])("CustomReports_ErrorMissingMetric");return this.showNotification(i,"error"),!1}return this.isProductRevenueDependencyMet(!1),!0},setSubcategory:function(e){this.report.subcategory=this.report.subcategory||{id:""},this.report.subcategory.id=e},isProductRevenueDependencyMet:function(e){var t=Object(Ze["externalLink"])("https://matomo.org/faq/custom-reports/why-is-there-an-error-when-i-try-to-run-a-custom-report-with-the-product-revenue-metric/"),o=Object(Ze["translate"])("CustomReports_WarningProductRevenueMetricDependency",t,"</a>");return this.report.metrics.includes("sum_product_revenue")&&!this.doesReportIncludeProductQuantityMetric()?(this.addMetric("sum_ecommerce_productquantity"),this.showProductMetricNotification(o,e),!1):!(this.report.metrics.includes("avg_product_revenue")&&!this.doesReportIncludeProductQuantityMetric())||(this.addMetric("avg_ecommerce_productquantity"),this.showProductMetricNotification(o,e),!1)},doesReportIncludeProductQuantityMetric:function(){return this.report.metrics.includes("sum_ecommerce_productquantity")||this.report.metrics.includes("avg_ecommerce_productquantity")},isSiteIncludedAlready:function(e){return!(!this.multipleSites||!this.multipleSites.length)&&this.multipleSites.some((function(t){return"".concat(t.idsite)==="".concat(e)}))},removeSite:function(e){this.multipleSites&&(this.isDirty=!0,this.multipleSites=this.multipleSites.filter((function(t){return t.idsite!==e.idsite})))},addSitesContaining:function(e){var t=this;if(e){var o='"'.concat(Ze["Matomo"].helper.escape(Ze["Matomo"].helper.htmlEntities(e)),'"');Ze["AjaxHelper"].fetch({method:"SitesManager.getSitesWithAdminAccess",pattern:e,filter_limit:-1}).then((function(e){if(e&&e.length){var r=[],i=[];e.forEach((function(e){var o=window.vueSanitize(Ze["Matomo"].helper.htmlEntities(e.name)),n="".concat(o," (id ").concat(parseInt("".concat(e.idsite),10),")<br />");t.isSiteIncludedAlready("".concat(e.idsite))?i.push(n):r.push(n)}));var n=Object(Ze["translate"])("CustomReports_MatchingSearchConfirmTitle",r.length);if(i.length){var s=Object(Ze["translate"])("CustomReports_MatchingSearchConfirmTitleAlreadyAdded",i.length);n+=" (".concat(s,")")}var a="<div><h2>".concat(n,"</h2><p>\n          ").concat(Object(Ze["translate"])("CustomReports_MatchingSearchMatchedAdd",r.length,o),":\n          <br /><br />");if(a+=r.join(""),i.length){var l=Object(Ze["translate"])("CustomReports_MatchingSearchMatchedAlreadyAdded",i.length,o);a+="<br />".concat(l,":<br /><br />").concat(i.join(""))}a+='</p><input role="yes" type="button" value="'.concat(Object(Ze["translate"])("General_Yes"),'"/>\n          <input role="no" type="button" value="').concat(Object(Ze["translate"])("General_No"),'"/>\n          </div>'),Ze["Matomo"].helper.modalConfirm(a,{yes:function(){e.forEach((function(e){t.multipleSites&&(t.isSiteIncludedAlready("".concat(e.idsite))||(t.isDirty=!0,t.multipleSites.push({idsite:e.idsite,name:e.name})))})),t.containsText=""}})}else{var c="<div>\n            <h2>".concat(Object(Ze["translate"])("CustomReports_MatchingSearchNotFound",o),'</h2>\n            <input role="ok" type="button" value="').concat(Object(Ze["translate"])("General_Ok"),'"/>\n          </div>');Ze["Matomo"].helper.modalConfirm(c)}}))}}},computed:{isSuperUser:function(){return!!Ze["Matomo"].hasSuperUserAccess},allMetrics:function(){return vt.state.value.allMetrics},metrics:function(){var e,t=["pageviews_with_generation_time","avg_page_generation_time","max_actions_pagegenerationtime","sum_actions_pagegenerationtime"],o=((null===(e=this.report)||void 0===e?void 0:e.metrics)||[]).some((function(e){return t.indexOf(e)>=0})),r=!o;return this.allMetrics.filter((function(e){return!!e&&!(r&&t.indexOf(e.key)>=0)}))},allDimensions:function(){return vt.state.value.allDimensions},reportTypes:function(){return vt.state.value.reportTypesReadable},create:function(){return!this.idCustomReport},edit:function(){return!this.create},editTitle:function(){return this.create?"CustomReports_CreateNewReport":"CustomReports_EditReport"},contentTitle:function(){return Object(Ze["translate"])(this.editTitle,this.report.name?'"'.concat(this.report.name,'"'):"")},categories:function(){return vt.state.value.categories},subcategories:function(){return vt.state.value.subcategories},dimensions:function(){var e,t=ft(this.allDimensions);if(null===(e=this.report)||void 0===e||!e.dimensions)return t;for(var o=-1!==this.report.dimensions.indexOf("Actions.PageGenerationTime"),r=this.report.dimensions.map((function(e){var o;return null===(o=t.find((function(t){return t.key===e})))||void 0===o?void 0:o.sqlSegment})).filter((function(e){return!!e})),i=0;i<t.length;i+=1){var n=t[i];if(!o&&"Actions.PageGenerationTime"===n.key){t.splice(i,1),i-=1;break}n.sqlSegment&&r.indexOf(n.sqlSegment)>-1&&-1===this.report.dimensions.indexOf(n.key)&&(t.splice(i,1),i-=1)}return t},isLoading:function(){return vt.state.value.isLoading},isUpdating:function(){return vt.state.value.isUpdating},dimensionsReadable:function(){return vt.state.value.dimensionsReadable},metricsReadable:function(){return vt.state.value.metricsReadable},saveButtonText:function(){return this.edit?Object(Ze["translate"])("CoreUpdater_UpdateTitle"):Object(Ze["translate"])("CustomReports_CreateNewReport")},getProductRevenueDependencyMessage:function(){var e=Object(Ze["externalLink"])("https://matomo.org/faq/custom-reports/why-is-there-an-error-when-i-try-to-run-a-custom-report-with-the-product-revenue-metric/");return Object(Ze["translate"])("CustomReports_WarningProductRevenueMetricDependency",e,"</a>")}}});kt.render=Ke;var Vt=kt,wt={class:"reportSearchFilter"},_t={class:"index"},Dt={class:"name"},Mt={class:"description"},At={class:"reportType"},It={class:"reportCategory"},Ut={class:"action"},Bt={colspan:"7"},Lt={class:"loadingPiwik"},Tt=Object(n["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Pt={colspan:"7"},xt=["id"],Ht={class:"index"},Gt={class:"name"},qt=["title"],Ft=["title"],Wt=["title"],$t=["title"],zt=["title"],Qt={class:"reportType"},Yt=["title"],Xt={key:0},Jt={class:"action"},Kt=["title","onClick"],Zt=["title","href"],eo=["title","onClick"],to={class:"tableActionBar"},oo=Object(n["createElementVNode"])("span",{class:"icon-add"},null,-1),ro={class:"ui-confirm",ref:"confirmDeleteReport"},io=["value"],no=["value"];function so(e,t,o,r,i,s){var a=Object(n["resolveComponent"])("Field"),l=Object(n["resolveComponent"])("ContentBlock"),c=Object(n["resolveDirective"])("content-table");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",null,[Object(n["createVNode"])(l,{"content-title":e.translate("CustomReports_ManageReports"),feature:e.translate("CustomReports_ManageReports")},{default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(e.translate("CustomReports_CustomReportIntroduction")),1),Object(n["createElementVNode"])("div",wt,[Object(n["withDirectives"])(Object(n["createVNode"])(a,{uicontrol:"text",name:"reportSearch",title:e.translate("General_Search"),modelValue:e.searchFilter,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.searchFilter=t})},null,8,["title","modelValue"]),[[n["vShow"],e.reports.length>0]])]),Object(n["withDirectives"])(Object(n["createElementVNode"])("table",null,[Object(n["createElementVNode"])("thead",null,[Object(n["createElementVNode"])("tr",null,[Object(n["createElementVNode"])("th",_t,Object(n["toDisplayString"])(e.translate("General_Id")),1),Object(n["createElementVNode"])("th",Dt,Object(n["toDisplayString"])(e.translate("General_Name")),1),Object(n["createElementVNode"])("th",Mt,Object(n["toDisplayString"])(e.translate("General_Description")),1),Object(n["createElementVNode"])("th",At,Object(n["toDisplayString"])(e.translate("CustomReports_Type")),1),Object(n["createElementVNode"])("th",It,Object(n["toDisplayString"])(e.translate("CustomReports_Category")),1),Object(n["createElementVNode"])("th",Ut,Object(n["toDisplayString"])(e.translate("General_Actions")),1)])]),Object(n["createElementVNode"])("tbody",null,[Object(n["withDirectives"])(Object(n["createElementVNode"])("tr",null,[Object(n["createElementVNode"])("td",Bt,[Object(n["createElementVNode"])("span",Lt,[Tt,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[n["vShow"],e.isLoading||e.isUpdating]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("tr",null,[Object(n["createElementVNode"])("td",Pt,Object(n["toDisplayString"])(e.translate("CustomReports_NoCustomReportsFound")),1)],512),[[n["vShow"],!e.isLoading&&0==e.reports.length]]),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.sortedReports,(function(t){var o;return Object(n["openBlock"])(),Object(n["createElementBlock"])("tr",{id:"report".concat(t.idcustomreport),class:"customReports",key:t.idcustomreport},[Object(n["createElementVNode"])("td",Ht,Object(n["toDisplayString"])(t.idcustomreport),1),Object(n["createElementVNode"])("td",Gt,[Object(n["createTextVNode"])(Object(n["toDisplayString"])(t.name)+" ",1),Object(n["withDirectives"])(Object(n["createElementVNode"])("span",{class:"icon-locked",title:e.translate("CustomReports_ReportEditNotAllowedAllWebsitesUpdated")},null,8,qt),[[n["vShow"],!t.idsite&&!e.isSuperUser]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("span",{class:"icon-info2",title:e.translate("CustomReports_ReportAvailableToAllWebsites")},null,8,Ft),[[n["vShow"],!t.idsite&&e.isSuperUser]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("span",{class:"icon-locked",title:e.translate("CustomReports_ReportEditNotAllowedMultipleWebsitesAccessIssue")},null,8,Wt),[[n["vShow"],!t.allowedToEdit&&e.isMultiSiteReport(t)]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("span",{class:"icon-info2",title:e.translate("CustomReports_ReportAvailableToMultipleWebsites")},null,8,$t),[[n["vShow"],t.allowedToEdit&&e.isMultiSiteReport(t)]])]),Object(n["createElementVNode"])("td",{class:"description",title:e.htmlEntities(t.description)},Object(n["toDisplayString"])(e.truncate(t.description.trim(),60)),9,zt),Object(n["createElementVNode"])("td",Qt,Object(n["toDisplayString"])(e.reportTypesReadable[t.report_type]),1),Object(n["createElementVNode"])("td",{class:"reportCategory",title:e.htmlEntities(t.category.name)},[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.truncate(t.category.name.trim(),60))+" ",1),null!==(o=t.subcategory)&&void 0!==o&&o.name?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",Xt," - "+Object(n["toDisplayString"])(e.truncate(t.subcategory.name.trim(),60)),1)):Object(n["createCommentVNode"])("",!0)],8,Yt),Object(n["createElementVNode"])("td",Jt,[Object(n["createElementVNode"])("a",{class:"table-action icon-edit",title:e.translate("CustomReports_EditReport"),onClick:function(o){return e.editReport(t.idcustomreport)}},null,8,Kt),Object(n["createElementVNode"])("a",{target:"_blank",class:"table-action icon-show",title:e.translate("CustomReports_ViewReportInfo"),href:e.getViewReportLink(t)},null,8,Zt),Object(n["withDirectives"])(Object(n["createElementVNode"])("a",{class:"table-action icon-delete",title:e.translate("CustomReports_DeleteReportInfo"),onClick:function(o){return e.deleteReport(t)}},null,8,eo),[[n["vShow"],t.idsite&&!e.isMultiSiteReport(t)||t.allowedToEdit]])])],8,xt)})),128))])],512),[[c]]),Object(n["createElementVNode"])("div",to,[Object(n["createElementVNode"])("a",{class:"createNewReport",onClick:t[1]||(t[1]=function(t){return e.createReport()})},[oo,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("CustomReports_CreateNewReport")),1)])])]})),_:1},8,["content-title","feature"]),Object(n["createElementVNode"])("div",ro,[Object(n["createElementVNode"])("h2",null,Object(n["toDisplayString"])(e.translate("CustomReports_DeleteReportConfirm")),1),Object(n["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,io),Object(n["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,no)],512)])}
/**
 * Copyright (C) InnoCraft Ltd - All rights reserved.
 *
 * NOTICE:  All information contained herein is, and remains the property of InnoCraft Ltd.
 * The intellectual and technical concepts contained herein are protected by trade secret
 * or copyright law. Redistribution of this information or reproduction of this material is
 * strictly forbidden unless prior written permission is obtained from InnoCraft Ltd.
 *
 * You shall use this code only in accordance with the license agreement obtained from
 * InnoCraft Ltd.
 *
 * @link https://www.innocraft.com/
 * @license For license details see https://www.innocraft.com/license
 */function ao(e,t){return e&&e.length>t?"".concat(e.substr(0,t-3),"..."):e}function lo(e){return mo(e)||po(e)||uo(e)||co()}function co(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function uo(e,t){if(e){if("string"===typeof e)return ho(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?ho(e,t):void 0}}function po(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function mo(e){if(Array.isArray(e))return ho(e)}function ho(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var bo=Object(n["defineComponent"])({props:{},components:{ContentBlock:Ze["ContentBlock"],Field:et["Field"]},directives:{ContentTable:Ze["ContentTable"]},data:function(){return{searchFilter:""}},created:function(){vt.getAvailableReportTypes(),vt.fetchReports()},methods:{createReport:function(){this.editReport(0)},editReport:function(e){Ze["MatomoUrl"].updateHash(Object.assign(Object.assign({},Ze["MatomoUrl"].hashParsed.value),{},{idCustomReport:e}))},deleteReport:function(e){Ze["Matomo"].helper.modalConfirm(this.$refs.confirmDeleteReport,{yes:function(){vt.deleteReport(e.idcustomreport,e.idsite).then((function(){vt.reload(),Ze["Matomo"].postEvent("updateReportingMenu")}))}})},getViewReportLink:function(e){return"?".concat(Ze["MatomoUrl"].stringify({module:"CoreHome",action:"index",idSite:e.linkIdSite,period:"day",date:"yesterday"}),"#?").concat(Ze["MatomoUrl"].stringify({category:e.category.id,idSite:e.linkIdSite,date:Ze["MatomoUrl"].parsed.value.date,period:Ze["MatomoUrl"].parsed.value.period,segment:Ze["MatomoUrl"].parsed.value.segment,subcategory:e.subcategoryLink}))},truncate:ao,htmlEntities:function(e){return Ze["Matomo"].helper.htmlEntities(e)},isMultiSiteReport:function(e){return e.multiple_idsites&&e.multiple_idsites.split(",")}},computed:{isSuperUser:function(){return Ze["Matomo"].hasSuperUserAccess},reports:function(){return vt.state.value.reports},sortedReports:function(){var e=this.searchFilter.toLowerCase(),t=lo(this.reports).filter((function(t){return Object.keys(t).some((function(o){var r=t;return"string"===typeof r[o]&&-1!==r[o].toLowerCase().indexOf(e)}))}));return t.sort((function(e,t){var o=parseInt("".concat(e.idcustomreport),10),r=parseInt("".concat(t.idcustomreport),10);return o-r})),t},isLoading:function(){return vt.state.value.isLoading},isUpdating:function(){return vt.state.value.isUpdating},reportTypesReadable:function(){return vt.state.value.reportTypesReadable}}});bo.render=so;var vo=bo,fo={class:"manageReports"},go={key:0},jo={key:1};function Oo(e,t,o,r,i,s){var a=Object(n["resolveComponent"])("CustomReportsList"),l=Object(n["resolveComponent"])("CustomReportsEdit");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",fo,[e.editMode?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",go,[Object(n["createVNode"])(a)])),e.editMode?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",jo,[Object(n["createVNode"])(l,{"id-custom-report":e.idCustomReport,"browser-archiving-disabled":e.browserArchivingDisabled,"re-archive-last-n":e.reArchiveLastN},null,8,["id-custom-report","browser-archiving-disabled","re-archive-last-n"])])):Object(n["createCommentVNode"])("",!0)])}var yo=Object(n["defineComponent"])({props:{browserArchivingDisabled:Boolean,reArchiveLastN:Number},components:{CustomReportsList:vo,CustomReportsEdit:Vt},data:function(){return{editMode:!1,idCustomReport:null}},watch:{editMode:function(){$(".ui-tooltip").remove()}},created:function(){var e=this;Object(n["watch"])((function(){return Ze["MatomoUrl"].hashParsed.value.idCustomReport}),(function(t){e.initState(t)})),this.initState(Ze["MatomoUrl"].hashParsed.value.idCustomReport)},methods:{removeAnyReportNotification:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Ze["NotificationsStore"].remove("reportsmanagement"),e&&Ze["NotificationsStore"].remove("reportsmanagementProductMetric")},initState:function(e){if(e){if("0"===e){var t={isAllowed:!0};if(Ze["Matomo"].postEvent("CustomReports.initAddReport",t),t&&!t.isAllowed)return this.editMode=!1,void(this.idCustomReport=null)}this.editMode=!0,this.idCustomReport=parseInt(e,10)}else this.editMode=!1,this.idCustomReport=null;this.removeAnyReportNotification(!e)}}});yo.render=Oo;var Ro=yo;
/**
 * Copyright (C) InnoCraft Ltd - All rights reserved.
 *
 * NOTICE:  All information contained herein is, and remains the property of InnoCraft Ltd.
 * The intellectual and technical concepts contained herein are protected by trade secret
 * or copyright law. Redistribution of this information or reproduction of this material is
 * strictly forbidden unless prior written permission is obtained from InnoCraft Ltd.
 *
 * You shall use this code only in accordance with the license agreement obtained from
 * InnoCraft Ltd.
 *
 * @link https://www.innocraft.com/
 * @license For license details see https://www.innocraft.com/license
 */}})}));
//# sourceMappingURL=CustomReports.umd.min.js.map