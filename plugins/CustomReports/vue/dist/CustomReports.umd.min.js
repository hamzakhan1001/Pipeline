(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin"),require("SegmentEditor")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin","SegmentEditor"],t):"object"===typeof exports?exports["CustomReports"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin"),require("SegmentEditor")):e["CustomReports"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"],e["SegmentEditor"])})("undefined"!==typeof self?self:this,(function(e,t,r,o){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(o,i,function(t){return e[t]}.bind(null,i));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="plugins/CustomReports/vue/dist/",r(r.s="fae3")}({"19dc":function(t,r){t.exports=e},"8bbf":function(e,r){e.exports=t},a5a2:function(e,t){e.exports=r},f06f:function(e,t){e.exports=o},fae3:function(e,t,r){"use strict";if(r.r(t),r.d(t,"ReportEdit",(function(){return Xe})),r.d(t,"ReportsList",(function(){return Ut})),r.d(t,"ReportsManage",(function(){return xt})),"undefined"!==typeof window){var o=window.document.currentScript,i=o&&o.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(r.p=i[1])}var n=r("8bbf"),s={class:"loadingPiwik"},a=Object(n["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),l={class:"loadingPiwik"},c=Object(n["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),d={name:"name"},u={name:"description"},p={class:"form-group row"},m={class:"col s12"},b={class:"col s12 m6"},h={for:"all_websites",class:"siteSelectorLabel"},f={class:"sites_autocomplete"},v={class:"col s12 m6"},g={class:"form-help"},j={class:"inline-help"},O={class:"form-group row"},y={class:"col s12"},R={class:"unlockAlert alert alert-info"},C={key:0},N={key:1},S=Object(n["createElementVNode"])("br",null,null,-1),V=Object(n["createElementVNode"])("br",null,null,-1),E=["value"],k={class:"alertUnlocked alert alert-warning"},w={key:0},_={key:1},D={name:"reportType"},A={class:"form-group row"},M={class:"col s12 m6 dimensionsGroup"},U=Object(n["createElementVNode"])("br",null,null,-1),L={class:"groupValueSelect",name:"dimensions"},B=["title","onClick"],P={class:"groupValueSelect addDimension",name:"dimensions"},I={class:"col s12 m6"},T={class:"form-help"},x={class:"inline-help"},H={class:"form-group row"},G={class:"col s12 m6 metricsGroup"},F=Object(n["createElementVNode"])("br",null,null,-1),q={class:"groupValueSelect",name:"metrics"},W=["title","onClick"],z={class:"groupValueSelect addMetric",name:"metrics"},Y={class:"col s12 m6"},X={class:"form-help"},J={class:"inline-help"},K={class:"form-group row segmentFilterGroup"},Q={class:"col s12"},Z={style:{margin:"8px 0",display:"inline-block"}},ee={class:"form-group row"},te={class:"col s12"},re=Object(n["createElementVNode"])("br",null,null,-1),oe=Object(n["createElementVNode"])("br",null,null,-1),ie={name:"reportCategories"},ne={name:"reportSubcategories"},se={class:"alert alert-warning"},ae={key:0},le={key:1},ce={class:"entityCancel"},de={class:"ui-confirm",id:"confirmUnlockReport",ref:"confirmUnlockReport"},ue={key:0},pe={key:1},me=["value"],be=["value"],he={class:"ui-confirm",id:"infoReportIsLocked",ref:"infoReportIsLocked"},fe={key:0},ve={key:1},ge=["value"],je=["value"];function Oe(e,t,r,o,i,$){var Oe=Object(n["resolveComponent"])("Field"),ye=Object(n["resolveComponent"])("SiteSelector"),Re=Object(n["resolveComponent"])("SegmentGenerator"),Ce=Object(n["resolveComponent"])("SaveButton"),Ne=Object(n["resolveComponent"])("ContentBlock");return Object(n["openBlock"])(),Object(n["createBlock"])(Ne,{class:"editReport","content-title":e.contentTitle},{default:Object(n["withCtx"])((function(){var r,o,i;return[Object(n["withDirectives"])(Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("span",s,[a,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[n["vShow"],e.isLoading]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("span",l,[c,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("CustomReports_UpdatingData")),1)])],512),[[n["vShow"],e.isUpdating]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",{class:"alert alert-danger"},Object(n["toDisplayString"])(e.translate("CustomReports_ReportEditNotAllowedAllWebsites")),513),[[n["vShow"],!e.canEdit]]),Object(n["createElementVNode"])("form",{onSubmit:t[13]||(t[13]=function(t){return e.edit?e.updateReport():e.createReport()})},[Object(n["createElementVNode"])("div",null,[Object(n["createElementVNode"])("div",d,[Object(n["createVNode"])(Oe,{uicontrol:"text",name:"name","model-value":e.report.name,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.report.name=t,e.setValueHasChanged()}),title:e.translate("General_Name"),maxlength:50,disabled:!e.canEdit,placeholder:e.translate("CustomReports_FieldNamePlaceholder"),"inline-help":e.translate("CustomReports_ReportNameHelp")},null,8,["model-value","title","disabled","placeholder","inline-help"])]),Object(n["createElementVNode"])("div",u,[Object(n["createVNode"])(Oe,{uicontrol:"textarea",name:"description","model-value":e.report.description,"onUpdate:modelValue":t[1]||(t[1]=function(t){e.report.description=t,e.setValueHasChanged()}),title:"".concat(e.translate("General_Description")," (optional)"),maxlength:1e3,disabled:!e.canEdit,rows:3,placeholder:e.translate("CustomReports_FieldDescriptionPlaceholder"),"inline-help":e.translate("CustomReports_ReportDescriptionHelp")},null,8,["model-value","title","disabled","placeholder","inline-help"])]),Object(n["createElementVNode"])("div",p,[Object(n["createElementVNode"])("h3",m,Object(n["toDisplayString"])(e.translate("CustomReports_ApplyTo")),1),Object(n["createElementVNode"])("div",b,[Object(n["createElementVNode"])("div",null,[Object(n["createElementVNode"])("label",h,Object(n["toDisplayString"])(e.translate("General_Website")),1),Object(n["createElementVNode"])("div",f,[Object(n["createVNode"])(ye,{id:"all_websites","model-value":e.report.site,"onUpdate:modelValue":t[2]||(t[2]=function(t){e.report.site=t,e.setWebsiteChanged()}),"show-all-sites-item":e.isSuperUser,"switch-site-on-select":!1,"show-selected-site":!0},null,8,["model-value","show-all-sites-item"])])])]),Object(n["createElementVNode"])("div",v,[Object(n["createElementVNode"])("div",g,[Object(n["createElementVNode"])("span",j,Object(n["toDisplayString"])(e.translate("CustomReports_ReportAllWebsitesHelp")),1)])])]),Object(n["createElementVNode"])("div",O,[Object(n["createElementVNode"])("h3",y,Object(n["toDisplayString"])(e.translate("CustomReports_ReportContent")),1)]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",R,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",C,Object(n["toDisplayString"])(e.translate("CustomReports_WarningRequiresUnlockBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(n["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",N,Object(n["toDisplayString"])(e.translate("CustomReports_WarningRequiresUnlock")),1)),S,V,Object(n["createElementVNode"])("input",{type:"button",class:"btn unlockReport",onClick:t[3]||(t[3]=function(t){return e.unlockReport()}),value:e.translate("CustomReports_Unlock")},null,8,E)],512),[[n["vShow"],e.isLocked]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",k,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",w,Object(n["toDisplayString"])(e.translate("CustomReports_WarningOnUpdateReportMightGetLostBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(n["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",_,Object(n["toDisplayString"])(e.translate("CustomReports_WarningOnUpdateReportMightGetLost")),1))],512),[[n["vShow"],e.isUnlocked]]),Object(n["createElementVNode"])("div",D,[Object(n["createVNode"])(Oe,{uicontrol:"radio",name:"reportType","model-value":e.report.report_type,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.setReportTypeHasChanged(t)}),title:e.translate("CustomReports_ReportType"),disabled:!e.canEdit,options:e.reportTypes},null,8,["model-value","title","disabled","options"])]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",A,[Object(n["createElementVNode"])("div",M,[Object(n["createElementVNode"])("label",null,Object(n["toDisplayString"])(e.translate("CustomReports_Dimensions")),1),U,Object(n["createElementVNode"])("div",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.report.dimensions,(function(t,r){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{class:Object(n["normalizeClass"])("selectedDimension selectedDimension".concat(r)),key:r},[Object(n["createElementVNode"])("div",L,[Object(n["createVNode"])(Oe,{uicontrol:"expandable-select",name:"dimensions","model-value":t,"onUpdate:modelValue":function(t){return e.changeDimension(t,r)},title:e.dimensionsReadable[t]||t,"full-width":!0,options:e.dimensions},null,8,["model-value","onUpdate:modelValue","title","options"])]),Object(n["createElementVNode"])("span",{class:"icon-minus",title:e.translate("CustomReports_RemoveDimension"),onClick:function(t){return e.removeDimension(r)}},null,8,B)],2)})),128)),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",P,[Object(n["createVNode"])(Oe,{uicontrol:"expandable-select",name:"dimensions","model-value":"","onUpdate:modelValue":t[5]||(t[5]=function(t){e.addDimension(t)}),title:e.translate("CustomReports_AddDimension"),"full-width":!0,options:e.dimensions},null,8,["title","options"])],512),[[n["vShow"],e.report.dimensions.length<=2]])])]),Object(n["createElementVNode"])("div",I,[Object(n["createElementVNode"])("div",T,[Object(n["createElementVNode"])("span",x,Object(n["toDisplayString"])(e.translate("CustomReports_ReportDimensionsHelp")),1)])])],512),[[n["vShow"],"evolution"!==e.report.report_type]]),Object(n["createElementVNode"])("div",H,[Object(n["createElementVNode"])("div",G,[Object(n["createElementVNode"])("label",null,Object(n["toDisplayString"])(e.translate("General_Metrics")),1),F,Object(n["createElementVNode"])("div",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.report.metrics,(function(t,r){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{class:Object(n["normalizeClass"])("selectedMetric selectedMetric".concat(r)),key:r},[Object(n["createElementVNode"])("div",q,[Object(n["createVNode"])(Oe,{uicontrol:"expandable-select",name:"metrics","model-value":t,"onUpdate:modelValue":function(t){return e.changeMetric(t,r)},title:e.metricsReadable[t]||t,"full-width":!0,options:e.metrics},null,8,["model-value","onUpdate:modelValue","title","options"])]),Object(n["createElementVNode"])("span",{class:"icon-minus",title:e.translate("CustomReports_RemoveMetric"),onClick:function(t){return e.removeMetric(r)}},null,8,W)],2)})),128)),Object(n["createElementVNode"])("div",z,[Object(n["createVNode"])(Oe,{uicontrol:"expandable-select",name:"metrics","model-value":"","onUpdate:modelValue":t[6]||(t[6]=function(t){e.addMetric(t)}),title:e.translate("CustomReports_AddMetric"),"full-width":!0,options:e.metrics},null,8,["title","options"])])])]),Object(n["createElementVNode"])("div",Y,[Object(n["createElementVNode"])("div",X,[Object(n["createElementVNode"])("span",J,Object(n["toDisplayString"])(e.translate("CustomReports_ReportMetricsHelp")),1)])])]),Object(n["createElementVNode"])("div",K,[Object(n["createElementVNode"])("div",Q,[Object(n["createElementVNode"])("div",null,[Object(n["createElementVNode"])("label",Z,Object(n["toDisplayString"])(e.translate("CustomReports_Filter")),1),Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(e.translate("CustomReports_ReportSegmentHelp")),1),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(Re,{"model-value":e.report.segment_filter,"onUpdate:modelValue":t[7]||(t[7]=function(t){return e.setSegmentFilterHasChanged(t)}),idsite:e.report.site.id},null,8,["model-value","idsite"])])])])]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",ee,[Object(n["createElementVNode"])("div",te,[re,oe,Object(n["createVNode"])(Ce,{class:"showPreviewButton",disabled:!(null!==(r=e.report.metrics)&&void 0!==r&&r.length)||!(null!==(o=e.report.dimensions)&&void 0!==o&&o.length),onConfirm:t[8]||(t[8]=function(t){return e.showPreview()}),value:e.translate("CustomReports_PreviewReport")},null,8,["disabled","value"])])],512),[[n["vShow"],"table"===e.report.report_type]]),Object(n["createElementVNode"])("div",ie,[Object(n["createVNode"])(Oe,{uicontrol:"select",name:"reportCategories","model-value":e.report.category.id,"onUpdate:modelValue":t[9]||(t[9]=function(t){e.report.category.id=t,e.setValueHasChanged()}),title:e.translate("CustomReports_ReportCategory"),disabled:!e.canEdit,options:e.categories,introduction:e.translate("CustomReports_ReportPage"),"inline-help":e.translate("CustomReports_ReportCategoryHelp")},null,8,["model-value","title","disabled","options","introduction","inline-help"])]),Object(n["createElementVNode"])("div",ne,[Object(n["createVNode"])(Oe,{uicontrol:"select",name:"reportSubcategories","model-value":null===(i=e.report.subcategory)||void 0===i?void 0:i.id,"onUpdate:modelValue":t[10]||(t[10]=function(t){e.setSubcategory(t),e.setValueHasChanged()}),title:e.translate("CustomReports_ReportSubcategory"),disabled:!e.canEdit,options:e.subcategories[e.report.category.id],"inline-help":e.translate("CustomReports_ReportSubcategoryHelp")},null,8,["model-value","title","disabled","options","inline-help"])]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",se,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",ae,Object(n["toDisplayString"])(e.translate("CustomReports_WarningOnUpdateReportMightGetLostBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(n["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",le,Object(n["toDisplayString"])(e.translate("CustomReports_WarningOnUpdateReportMightGetLost")),1))],512),[[n["vShow"],e.isUnlocked]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",{class:"alert alert-danger"},Object(n["toDisplayString"])(e.translate("CustomReports_ReportEditNotAllowedAllWebsites")),513),[[n["vShow"],!e.canEdit]]),Object(n["withDirectives"])(Object(n["createVNode"])(Ce,{class:"createButton",onConfirm:t[11]||(t[11]=function(t){return e.edit?e.updateReport():e.createReport()}),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.saveButtonText},null,8,["disabled","saving","value"]),[[n["vShow"],e.canEdit]]),Object(n["createElementVNode"])("div",ce,[Object(n["createElementVNode"])("a",{onClick:t[12]||(t[12]=function(t){return e.cancel()})},Object(n["toDisplayString"])(e.translate("General_Cancel")),1)])])],32),Object(n["createElementVNode"])("div",de,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(n["openBlock"])(),Object(n["createElementBlock"])("h2",ue,Object(n["toDisplayString"])(e.translate("CustomReports_ConfirmUnlockReportBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(n["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("h2",pe,Object(n["toDisplayString"])(e.translate("CustomReports_ConfirmUnlockReport")),1)),Object(n["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,me),Object(n["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,be)],512),Object(n["createElementVNode"])("div",he,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(n["openBlock"])(),Object(n["createElementBlock"])("h2",fe,Object(n["toDisplayString"])(e.translate("CustomReports_InfoReportIsLockedBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(n["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("h2",ve,Object(n["toDisplayString"])(e.translate("CustomReports_InfoReportIsLocked")),1)),Object(n["createElementVNode"])("input",{role:"unlock",type:"button",value:e.translate("CustomReports_Unlock")},null,8,ge),Object(n["createElementVNode"])("input",{role:"ok",type:"button",value:e.translate("General_Cancel")},null,8,je)],512)]})),_:1},8,["content-title"])}var ye=r("19dc"),Re=r("a5a2"),Ce=r("f06f");function Ne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Se(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ve(e,t,r){return t&&Se(e.prototype,t),r&&Se(e,r),e}function Ee(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ke(e){return Ae(e)||De(e)||_e(e)||we()}function we(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _e(e,t){if(e){if("string"===typeof e)return Me(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Me(e,t):void 0}}function De(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Ae(e){if(Array.isArray(e))return Me(e)}function Me(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}
/**
 * Copyright (C) InnoCraft Ltd - All rights reserved.
 *
 * NOTICE:  All information contained herein is, and remains the property of InnoCraft Ltd.
 * The intellectual and technical concepts contained herein are protected by trade secret
 * or copyright law. Redistribution of this information or reproduction of this material is
 * strictly forbidden unless prior written permission is obtained from InnoCraft Ltd.
 *
 * You shall use this code only in accordance with the license agreement obtained from
 * InnoCraft Ltd.
 *
 * @link https://www.innocraft.com/
 * @license For license details see https://www.innocraft.com/license
 */function Ue(e){return ke(new Set(e)).filter((function(e){return!!e}))}function Le(e,t,r){var o=[];return e.forEach((function(e){e[t].forEach((function(t){o.push(Object.assign({group:e.category,key:t.uniqueId,value:t.name,tooltip:t.description||void 0},r?Ee({},r,t[r]):{}))}))})),o}var Be={key:"",value:""},Pe=function(){function e(){var t=this;Ne(this,e),Ee(this,"privateState",Object(n["reactive"])({reports:[],reportTypesReadable:{},dimensionsReadable:{},metricsReadable:{},categories:[],subcategories:{},isLoading:!1,isUpdating:!1,allMetrics:[],allDimensions:[]})),Ee(this,"state",Object(n["computed"])((function(){return Object(n["readonly"])(t.privateState)}))),Ee(this,"fetchPromise",null),Ee(this,"availableReportTypesPromise",null),Ee(this,"dimensionsPromise",null),Ee(this,"dimensionsIdsiteLoaded",0),Ee(this,"metricsPromise",null),Ee(this,"metricsIdsiteLoaded",0),Ee(this,"categoriesPromise",null),Ee(this,"categoriesIdsiteLoaded",null)}return Ve(e,[{key:"reload",value:function(){return this.privateState.reports=[],this.fetchPromise=null,this.fetchReports()}},{key:"cleanupSegmentDefinition",value:function(e){var t=e;return t=t.replace("'","%27"),t=t.replace("&","%26"),t}},{key:"getAvailableReportTypes",value:function(){var e=this;return this.availableReportTypesPromise||(this.availableReportTypesPromise=ye["AjaxHelper"].fetch({method:"CustomReports.getAvailableReportTypes",filter_limit:"-1"}).then((function(t){var r={};t.forEach((function(e){r[e.key]=e.value})),e.privateState.reportTypesReadable=r}))),this.availableReportTypesPromise.then((function(){return e.state.value.reportTypesReadable}))}},{key:"getAvailableDimensions",value:function(e){var t=this;return this.dimensionsPromise&&this.dimensionsIdsiteLoaded===e||(this.dimensionsIdsiteLoaded=e,this.dimensionsPromise=ye["AjaxHelper"].fetch({method:"CustomReports.getAvailableDimensions",filter_limit:"-1",idSite:e}).then((function(e){var r={};e.forEach((function(e){e.dimensions.forEach((function(e){r[e.uniqueId]=e.name}))})),t.privateState.dimensionsReadable=r,t.privateState.allDimensions=Le(e,"dimensions","sqlSegment")}))),this.dimensionsPromise.then((function(){return t.state.value.dimensionsReadable}))}},{key:"getAvailableMetrics",value:function(e){var t=this;return this.metricsPromise&&this.metricsIdsiteLoaded===e||(this.metricsIdsiteLoaded=e,this.metricsPromise=ye["AjaxHelper"].fetch({method:"CustomReports.getAvailableMetrics",filter_limit:"-1",idSite:e}).then((function(e){var r={};e.forEach((function(e){e.metrics.forEach((function(e){r[e.uniqueId]=e.name}))})),t.privateState.metricsReadable=r,t.privateState.allMetrics=Le(e,"metrics")}))),this.metricsPromise.then((function(){return t.state.value.metricsReadable}))}},{key:"getAvailableCategories",value:function(e){var t=this,r=e&&"all"!==e?e:ye["Matomo"].idSite;return this.categoriesPromise&&this.categoriesIdsiteLoaded===e||(this.categoriesPromise=ye["AjaxHelper"].fetch({method:"CustomReports.getAvailableCategories",filter_limit:"-1",idSite:r}).then((function(e){var r=[],o={};e.forEach((function(e){r.push({key:e.uniqueId,value:e.name}),e.subcategories.forEach((function(t){o[e.uniqueId]=o[e.uniqueId]||[Be],o[e.uniqueId].push({key:t.uniqueId,value:t.name})}))})),t.privateState.categories=r,t.privateState.subcategories=o}))),this.categoriesPromise}},{key:"fetchReports",value:function(){var e=this;return this.fetchPromise||(this.fetchPromise=ye["AjaxHelper"].fetch({method:"CustomReports.getConfiguredReports",filter_limit:"-1"})),this.privateState.isLoading=!0,this.privateState.reports=[],this.fetchPromise.then((function(t){return e.privateState.reports=t.map((function(e){var t,r,o=void 0;return o=null!==e&&void 0!==e&&null!==(t=e.subcategory)&&void 0!==t&&t.id?e.subcategory.id:"CustomReports_CustomReports"===(null===e||void 0===e||null===(r=e.category)||void 0===r?void 0:r.id)?e.idcustomreport:e.name,Object.assign(Object.assign({},e),{},{linkIdSite:e.idsite?e.idsite:ye["Matomo"].idSite,subcategoryLink:o})})),e.state.value.reports})).finally((function(){e.privateState.isLoading=!1}))}},{key:"findReport",value:function(e){var t=this,r=this.state.value.reports.find((function(t){return parseInt("".concat(t.idcustomreport),10)===e}));return r?Promise.resolve(r):(this.privateState.isLoading=!0,ye["AjaxHelper"].fetch({idCustomReport:e,method:"CustomReports.getConfiguredReport"}).finally((function(){t.privateState.isLoading=!1})))}},{key:"deleteReport",value:function(e,t){var r=this;return this.privateState.isUpdating=!0,this.privateState.reports=[],ye["AjaxHelper"].fetch({idCustomReport:e,idSite:"".concat(t),method:"CustomReports.deleteCustomReport"},{withTokenInUrl:!0}).then((function(){return{type:"success"}})).catch((function(e){return{type:"error",message:e.message||e}})).finally((function(){r.privateState.isUpdating=!1}))}},{key:"createOrUpdateReport",value:function(e,t){var r,o,i=this;return this.privateState.isUpdating=!0,ye["AjaxHelper"].post({method:t,idCustomReport:e.idcustomreport,reportType:e.report_type,name:e.name.trim(),description:e.description.trim(),segmentFilter:encodeURIComponent(e.segment_filter),categoryId:null===(r=e.category)||void 0===r?void 0:r.id,subcategoryId:null===(o=e.subcategory)||void 0===o?void 0:o.id,idSite:e.site.id},{dimensionIds:Ue(e.dimensions),metricIds:Ue(e.metrics)},{withTokenInUrl:!0}).then((function(e){return{type:"success",response:e}})).catch((function(e){return{type:"error",message:e.message||e}})).finally((function(){i.privateState.isUpdating=!1}))}}]),e}(),Ie=new Pe;function Te(e){return Fe(e)||Ge(e)||He(e)||xe()}function xe(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function He(e,t){if(e){if("string"===typeof e)return qe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qe(e,t):void 0}}function Ge(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Fe(e){if(Array.isArray(e))return qe(e)}function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}var We="reportsmanagement";function $e(e){return Te(new Set(e)).filter((function(e){return!!e}))}function ze(){return{dimensions:[],site:{id:ye["Matomo"].idSite,name:ye["Matomo"].currentSiteName},category:{}}}var Ye=Object(n["defineComponent"])({props:{idCustomReport:Number,browserArchivingDisabled:Boolean,reArchiveLastN:Number},components:{ContentBlock:ye["ContentBlock"],Field:Re["Field"],SiteSelector:ye["SiteSelector"],SegmentGenerator:Ce["SegmentGenerator"],SaveButton:Re["SaveButton"]},data:function(){return{isDirty:!1,report:ze(),isLocked:!1,isUnlocked:!1,canEdit:!0}},created:function(){Ie.getAvailableReportTypes(),this.init()},watch:{idCustomReport:function(e){null!==e&&this.init()}},methods:{initReportOptions:function(){var e=parseInt("".concat(this.report.site.id),10)||"all";Ie.getAvailableDimensions(e),Ie.getAvailableMetrics(e),Ie.getAvailableCategories(e)},doUnlock:function(){this.isLocked=!1,this.isUnlocked=!0},confirmReportIsLocked:function(e){var t=this;ye["Matomo"].helper.modalConfirm(this.$refs.infoReportIsLocked,{unlock:function(){t.doUnlock(),e&&e()}})},removeAnyReportNotification:function(){ye["NotificationsStore"].remove(We),ye["NotificationsStore"].remove("ajaxHelper")},showNotification:function(e,t){var r=ye["NotificationsStore"].show({message:e,context:t,id:We,type:"transient"});setTimeout((function(){ye["NotificationsStore"].scrollToNotification(r)}),100)},showErrorFieldNotProvidedNotification:function(e){var t=Object(ye["translate"])("CustomReports_ErrorXNotProvided",[e]);this.showNotification(t,"error")},init:function(){var e=this,t=this.idCustomReport;this.canEdit=!0,this.report=ze(),ye["Matomo"].helper.lazyScrollToContent(),this.edit&&t?Ie.findReport(t).then((function(t){if(t){e.report=Object(ye["clone"])(t),e.isLocked=!0,e.isUnlocked=!1,e.canEdit=!0;var r=e.report.idsite;0!==r&&"0"!==r&&"all"!==r||(r="all",e.isSuperUser||(e.canEdit=!1,e.isLocked=!1)),e.report.site={id:r,name:e.report.site.name},e.isDirty=!1,e.initReportOptions()}})):this.create&&(this.report={idsite:ye["Matomo"].idSite,site:{id:ye["Matomo"].idSite,name:ye["Matomo"].currentSiteName||ye["Matomo"].siteName},name:"",description:"",dimensions:[],metrics:["nb_visits"],report_type:"table",category:{id:"CustomReports_CustomReports"},subcategory:null,segment_filter:""},this.isLocked=!1,this.canEdit=!0,this.isDirty=!1,this.initReportOptions())},cancel:function(){var e=Object.assign({},ye["MatomoUrl"].hashParsed.value);delete e.idCustomReport,ye["MatomoUrl"].updateHash(e)},unlockReport:function(){var e=this;this.report&&this.isLocked&&ye["Matomo"].helper.modalConfirm(this.$refs.confirmUnlockReport,{yes:function(){e.doUnlock()}})},createReport:function(){var e=this,t="CustomReports.addCustomReport";this.removeAnyReportNotification(),this.checkRequiredFieldsAreSet()&&Ie.createOrUpdateReport(this.report,t).then((function(t){if(t&&"error"!==t.type&&t.response){e.isDirty=!1;var r=t.response.value;if(e.report.site){var o=e.report.site.id;if(o&&"all"!==o&&"".concat(o)!=="".concat(ye["Matomo"].idSite))return void ye["MatomoUrl"].updateUrl(Object.assign(Object.assign({},ye["MatomoUrl"].urlParsed.value),{},{idSite:o}),Object.assign(Object.assign({},ye["MatomoUrl"].hashParsed.value),{},{idCustomReport:r}))}Ie.reload().then((function(){ye["Matomo"].helper.isReportingPage()&&ye["Matomo"].postEvent("updateReportingMenu"),ye["MatomoUrl"].updateHash(Object.assign(Object.assign({},ye["MatomoUrl"].hashParsed.value),{},{idCustomReport:r})),setTimeout((function(){e.showNotification(Object(ye["translate"])("CustomReports_ReportCreated"),t.type)}),200)}))}}))},showPreview:function(){var e,t,r,o=null!==(e=this.report.site)&&void 0!==e&&e.id&&"all"!==this.report.site.id?this.report.site.id:ye["Matomo"].idSite,i=(null===(t=this.report.dimensions)||void 0===t?void 0:t.length)&&this.report.report_type&&"evolution"!==this.report.report_type,n=i?this.report.dimensions.join(","):void 0,s=!(null===(r=this.report.metrics)||void 0===r||!r.length),a=s?this.report.metrics.join(","):void 0,l=ye["MatomoUrl"].stringify({module:"CustomReports",action:"previewReport",period:"day",date:"today",idSite:o,report_type:this.report.report_type,dimensions:n,metrics:a,segment:this.report.segment_filter||void 0}),c=Object(ye["translate"])("CustomReports_Preview");window.Piwik_Popover.createPopupAndLoadUrl(l,c,"customReportPreview")},setValueHasChanged:function(){this.isDirty=!0},addDimension:function(e){var t=this;this.report&&e&&(this.isLocked?this.confirmReportIsLocked((function(){t.addDimension(e)})):(this.report.dimensions||(this.report.dimensions=[]),this.report.dimensions=[].concat(Te(this.report.dimensions),[e]),this.setValueHasChanged()))},changeDimension:function(e,t){var r,o=this;this.report&&e&&(this.isLocked?this.confirmReportIsLocked((function(){o.changeDimension(e,t)})):null!==(r=this.report.dimensions)&&void 0!==r&&r[t]&&(this.report.dimensions=Te(this.report.dimensions),this.report.dimensions[t]=e,this.setValueHasChanged()))},changeMetric:function(e,t){var r,o=this;this.report&&e&&(this.isLocked?this.confirmReportIsLocked((function(){o.changeMetric(e,t)})):null!==(r=this.report.metrics)&&void 0!==r&&r[t]&&(this.report.metrics=Te(this.report.metrics),this.report.metrics[t]=e,this.setValueHasChanged()))},setWebsiteChanged:function(){this.setValueHasChanged(),this.initReportOptions()},removeDimension:function(e){var t=this;this.isLocked?this.confirmReportIsLocked((function(){t.removeDimension(e)})):e>-1&&(this.report.dimensions=Te(this.report.dimensions),this.report.dimensions.splice(e,1),this.setValueHasChanged())},addMetric:function(e){var t=this;this.report&&e&&(this.report.metrics||(this.report.metrics=[]),this.isLocked?this.confirmReportIsLocked((function(){t.addMetric(e)})):(this.report.metrics=[].concat(Te(this.report.metrics),[e]),this.setValueHasChanged()))},removeMetric:function(e){var t=this;this.isLocked?this.confirmReportIsLocked((function(){t.removeMetric(e)})):e>-1&&(this.report.metrics=Te(this.report.metrics),this.report.metrics.splice(e,1),this.setValueHasChanged())},setReportTypeHasChanged:function(e){var t=this;this.report&&this.isLocked?e!==this.report.report_type&&this.confirmReportIsLocked((function(){t.report.report_type=e,t.setValueHasChanged()})):(this.report.report_type=e,this.setValueHasChanged())},setSegmentFilterHasChanged:function(e){var t=this;this.report&&this.isLocked?e!==this.report.segment_filter&&this.confirmReportIsLocked((function(){t.report.segment_filter=e,t.setValueHasChanged()})):(this.report.segment_filter=e,this.setValueHasChanged())},updateReport:function(){var e=this;if(this.removeAnyReportNotification(),this.checkRequiredFieldsAreSet()){var t="CustomReports.updateCustomReport";Ie.createOrUpdateReport(this.report,t).then((function(t){if(t&&"error"!==t.type){var r=e.report.site.id;e.isDirty=!1,e.canEdit=!0,r&&"all"!==r&&"".concat(r)!=="".concat(ye["Matomo"].idSite)?ye["MatomoUrl"].updateUrl(Object.assign(Object.assign({},ye["MatomoUrl"].urlParsed.value),{},{idSite:r}),Object.assign({},ye["MatomoUrl"].hashParsed.value)):(Ie.reload().then((function(){e.init()})),e.showNotification(Object(ye["translate"])("CustomReports_ReportUpdated"),t.type))}}))}},checkRequiredFieldsAreSet:function(){var e,t;if(!this.report.name){var r=Object(ye["translate"])("General_Name");return this.showErrorFieldNotProvidedNotification(r),!1}if("evolution"!==this.report.report_type&&(null===(t=this.report.dimensions)||void 0===t||!t.length||!$e(this.report.dimensions).length)){var o=Object(ye["translate"])("CustomReports_ErrorMissingDimension");return this.showNotification(o,"error"),!1}if(null===(e=this.report.metrics)||void 0===e||!e.length||!$e(this.report.metrics).length){var i=Object(ye["translate"])("CustomReports_ErrorMissingMetric");return this.showNotification(i,"error"),!1}return!0},setSubcategory:function(e){this.report.subcategory=this.report.subcategory||{id:""},this.report.subcategory.id=e}},computed:{isSuperUser:function(){return!!ye["Matomo"].hasSuperUserAccess},allMetrics:function(){return Ie.state.value.allMetrics},metrics:function(){var e,t=["pageviews_with_generation_time","avg_page_generation_time","max_actions_pagegenerationtime","sum_actions_pagegenerationtime"],r=((null===(e=this.report)||void 0===e?void 0:e.metrics)||[]).some((function(e){return t.indexOf(e)>=0})),o=!r;return this.allMetrics.filter((function(e){return!!e&&!(o&&t.indexOf(e.key)>=0)}))},allDimensions:function(){return Ie.state.value.allDimensions},reportTypes:function(){return Ie.state.value.reportTypesReadable},create:function(){return!this.idCustomReport},edit:function(){return!this.create},editTitle:function(){return this.create?"CustomReports_CreateNewReport":"CustomReports_EditReport"},contentTitle:function(){return Object(ye["translate"])(this.editTitle,this.report.name?'"'.concat(this.report.name,'"'):"")},categories:function(){return Ie.state.value.categories},subcategories:function(){return Ie.state.value.subcategories},dimensions:function(){var e,t=Te(this.allDimensions);if(null===(e=this.report)||void 0===e||!e.dimensions)return t;for(var r=-1!==this.report.dimensions.indexOf("Actions.PageGenerationTime"),o=this.report.dimensions.map((function(e){var r;return null===(r=t.find((function(t){return t.key===e})))||void 0===r?void 0:r.sqlSegment})).filter((function(e){return!!e})),i=0;i<t.length;i+=1){var n=t[i];if(!r&&"Actions.PageGenerationTime"===n.key){t.splice(i,1),i-=1;break}n.sqlSegment&&o.indexOf(n.sqlSegment)>-1&&-1===this.report.dimensions.indexOf(n.key)&&(t.splice(i,1),i-=1)}return t},isLoading:function(){return Ie.state.value.isLoading},isUpdating:function(){return Ie.state.value.isUpdating},dimensionsReadable:function(){return Ie.state.value.dimensionsReadable},metricsReadable:function(){return Ie.state.value.metricsReadable},saveButtonText:function(){return this.edit?Object(ye["translate"])("CoreUpdater_UpdateTitle"):Object(ye["translate"])("CustomReports_CreateNewReport")}}});Ye.render=Oe;var Xe=Ye,Je={class:"reportSearchFilter"},Ke={class:"index"},Qe={class:"name"},Ze={class:"description"},et={class:"reportType"},tt={class:"reportCategory"},rt={class:"action"},ot={colspan:"7"},it={class:"loadingPiwik"},nt=Object(n["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),st={colspan:"7"},at=["id"],lt={class:"index"},ct={class:"name"},dt=["title"],ut=["title"],pt=["title"],mt={class:"reportType"},bt=["title"],ht={key:0},ft={class:"action"},vt=["title","onClick"],gt=["title","href"],jt=["title","onClick"],Ot={class:"tableActionBar"},yt=Object(n["createElementVNode"])("span",{class:"icon-add"},null,-1),Rt={class:"ui-confirm",ref:"confirmDeleteReport"},Ct=["value"],Nt=["value"];function St(e,t,r,o,i,s){var a=Object(n["resolveComponent"])("Field"),l=Object(n["resolveComponent"])("ContentBlock"),c=Object(n["resolveDirective"])("content-table");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",null,[Object(n["createVNode"])(l,{"content-title":e.translate("CustomReports_ManageReports"),feature:e.translate("CustomReports_ManageReports")},{default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(e.translate("CustomReports_CustomReportIntroduction")),1),Object(n["createElementVNode"])("div",Je,[Object(n["withDirectives"])(Object(n["createVNode"])(a,{uicontrol:"text",name:"reportSearch",title:e.translate("General_Search"),modelValue:e.searchFilter,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.searchFilter=t})},null,8,["title","modelValue"]),[[n["vShow"],e.reports.length>0]])]),Object(n["withDirectives"])(Object(n["createElementVNode"])("table",null,[Object(n["createElementVNode"])("thead",null,[Object(n["createElementVNode"])("tr",null,[Object(n["createElementVNode"])("th",Ke,Object(n["toDisplayString"])(e.translate("General_Id")),1),Object(n["createElementVNode"])("th",Qe,Object(n["toDisplayString"])(e.translate("General_Name")),1),Object(n["createElementVNode"])("th",Ze,Object(n["toDisplayString"])(e.translate("General_Description")),1),Object(n["createElementVNode"])("th",et,Object(n["toDisplayString"])(e.translate("CustomReports_Type")),1),Object(n["createElementVNode"])("th",tt,Object(n["toDisplayString"])(e.translate("CustomReports_Category")),1),Object(n["createElementVNode"])("th",rt,Object(n["toDisplayString"])(e.translate("General_Actions")),1)])]),Object(n["createElementVNode"])("tbody",null,[Object(n["withDirectives"])(Object(n["createElementVNode"])("tr",null,[Object(n["createElementVNode"])("td",ot,[Object(n["createElementVNode"])("span",it,[nt,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[n["vShow"],e.isLoading||e.isUpdating]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("tr",null,[Object(n["createElementVNode"])("td",st,Object(n["toDisplayString"])(e.translate("CustomReports_NoCustomReportsFound")),1)],512),[[n["vShow"],!e.isLoading&&0==e.reports.length]]),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.sortedReports,(function(t){var r;return Object(n["openBlock"])(),Object(n["createElementBlock"])("tr",{id:"report".concat(t.idcustomreport),class:"customReports",key:t.idcustomreport},[Object(n["createElementVNode"])("td",lt,Object(n["toDisplayString"])(t.idcustomreport),1),Object(n["createElementVNode"])("td",ct,[Object(n["createTextVNode"])(Object(n["toDisplayString"])(t.name)+" ",1),Object(n["withDirectives"])(Object(n["createElementVNode"])("span",{class:"icon-locked",title:e.translate("CustomReports_ReportEditNotAllowedAllWebsites")},null,8,dt),[[n["vShow"],!t.idsite&&!e.isSuperUser]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("span",{class:"icon-info2",title:e.translate("CustomReports_ReportAvailableToAllWebsites")},null,8,ut),[[n["vShow"],!t.idsite&&e.isSuperUser]])]),Object(n["createElementVNode"])("td",{class:"description",title:e.htmlEntities(t.description)},Object(n["toDisplayString"])(e.truncate(t.description.trim(),60)),9,pt),Object(n["createElementVNode"])("td",mt,Object(n["toDisplayString"])(e.reportTypesReadable[t.report_type]),1),Object(n["createElementVNode"])("td",{class:"reportCategory",title:e.htmlEntities(t.category.name)},[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.truncate(t.category.name.trim(),60))+" ",1),null!==(r=t.subcategory)&&void 0!==r&&r.name?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",ht," - "+Object(n["toDisplayString"])(e.truncate(t.subcategory.name.trim(),60)),1)):Object(n["createCommentVNode"])("",!0)],8,bt),Object(n["createElementVNode"])("td",ft,[Object(n["createElementVNode"])("a",{class:"table-action icon-edit",title:e.translate("CustomReports_EditReport"),onClick:function(r){return e.editReport(t.idcustomreport)}},null,8,vt),Object(n["createElementVNode"])("a",{target:"_blank",class:"table-action icon-show",title:e.translate("CustomReports_ViewReportInfo"),href:e.getViewReportLink(t)},null,8,gt),Object(n["withDirectives"])(Object(n["createElementVNode"])("a",{class:"table-action icon-delete",title:e.translate("CustomReports_DeleteReportInfo"),onClick:function(r){return e.deleteReport(t)}},null,8,jt),[[n["vShow"],t.idsite||e.isSuperUser]])])],8,at)})),128))])],512),[[c]]),Object(n["createElementVNode"])("div",Ot,[Object(n["createElementVNode"])("a",{class:"createNewReport",onClick:t[1]||(t[1]=function(t){return e.createReport()})},[yt,Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.translate("CustomReports_CreateNewReport")),1)])])]})),_:1},8,["content-title","feature"]),Object(n["createElementVNode"])("div",Rt,[Object(n["createElementVNode"])("h2",null,Object(n["toDisplayString"])(e.translate("CustomReports_DeleteReportConfirm")),1),Object(n["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,Ct),Object(n["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,Nt)],512)])}
/**
 * Copyright (C) InnoCraft Ltd - All rights reserved.
 *
 * NOTICE:  All information contained herein is, and remains the property of InnoCraft Ltd.
 * The intellectual and technical concepts contained herein are protected by trade secret
 * or copyright law. Redistribution of this information or reproduction of this material is
 * strictly forbidden unless prior written permission is obtained from InnoCraft Ltd.
 *
 * You shall use this code only in accordance with the license agreement obtained from
 * InnoCraft Ltd.
 *
 * @link https://www.innocraft.com/
 * @license For license details see https://www.innocraft.com/license
 */function Vt(e,t){return e&&e.length>t?"".concat(e.substr(0,t-3),"..."):e}function Et(e){return Dt(e)||_t(e)||wt(e)||kt()}function kt(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function wt(e,t){if(e){if("string"===typeof e)return At(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?At(e,t):void 0}}function _t(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Dt(e){if(Array.isArray(e))return At(e)}function At(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}var Mt=Object(n["defineComponent"])({props:{},components:{ContentBlock:ye["ContentBlock"],Field:Re["Field"]},directives:{ContentTable:ye["ContentTable"]},data:function(){return{searchFilter:""}},created:function(){Ie.getAvailableReportTypes(),Ie.fetchReports()},methods:{createReport:function(){this.editReport(0)},editReport:function(e){ye["MatomoUrl"].updateHash(Object.assign(Object.assign({},ye["MatomoUrl"].hashParsed.value),{},{idCustomReport:e}))},deleteReport:function(e){ye["Matomo"].helper.modalConfirm(this.$refs.confirmDeleteReport,{yes:function(){Ie.deleteReport(e.idcustomreport,e.idsite).then((function(){Ie.reload(),ye["Matomo"].postEvent("updateReportingMenu")}))}})},getViewReportLink:function(e){return"?".concat(ye["MatomoUrl"].stringify({module:"CoreHome",action:"index",idSite:e.linkIdSite,period:"day",date:"yesterday"}),"#?").concat(ye["MatomoUrl"].stringify({category:e.category.id,idSite:e.linkIdSite,date:ye["MatomoUrl"].parsed.value.date,period:ye["MatomoUrl"].parsed.value.period,segment:ye["MatomoUrl"].parsed.value.segment,subcategory:e.subcategoryLink}))},truncate:Vt,htmlEntities:function(e){return ye["Matomo"].helper.htmlEntities(e)}},computed:{isSuperUser:function(){return ye["Matomo"].hasSuperUserAccess},reports:function(){return Ie.state.value.reports},sortedReports:function(){var e=this.searchFilter.toLowerCase(),t=Et(this.reports).filter((function(t){return Object.keys(t).some((function(r){var o=t;return"string"===typeof o[r]&&-1!==o[r].toLowerCase().indexOf(e)}))}));return t.sort((function(e,t){var r=parseInt("".concat(e.idcustomreport),10),o=parseInt("".concat(t.idcustomreport),10);return r-o})),t},isLoading:function(){return Ie.state.value.isLoading},isUpdating:function(){return Ie.state.value.isUpdating},reportTypesReadable:function(){return Ie.state.value.reportTypesReadable}}});Mt.render=St;var Ut=Mt,Lt={class:"manageReports"},Bt={key:0},Pt={key:1};function It(e,t,r,o,i,s){var a=Object(n["resolveComponent"])("CustomReportsList"),l=Object(n["resolveComponent"])("CustomReportsEdit");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Lt,[e.editMode?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Bt,[Object(n["createVNode"])(a)])),e.editMode?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Pt,[Object(n["createVNode"])(l,{"id-custom-report":e.idCustomReport,"browser-archiving-disabled":e.browserArchivingDisabled,"re-archive-last-n":e.reArchiveLastN},null,8,["id-custom-report","browser-archiving-disabled","re-archive-last-n"])])):Object(n["createCommentVNode"])("",!0)])}var Tt=Object(n["defineComponent"])({props:{browserArchivingDisabled:Boolean,reArchiveLastN:Number},components:{CustomReportsList:Ut,CustomReportsEdit:Xe},data:function(){return{editMode:!1,idCustomReport:null}},watch:{editMode:function(){$(".ui-tooltip").remove()}},created:function(){var e=this;Object(n["watch"])((function(){return ye["MatomoUrl"].hashParsed.value.idCustomReport}),(function(t){e.initState(t)})),this.initState(ye["MatomoUrl"].hashParsed.value.idCustomReport)},methods:{removeAnyReportNotification:function(){ye["NotificationsStore"].remove("reportsmanagement")},initState:function(e){if(e){if("0"===e){var t={isAllowed:!0};if(ye["Matomo"].postEvent("CustomReports.initAddReport",t),t&&!t.isAllowed)return this.editMode=!1,void(this.idCustomReport=null)}this.editMode=!0,this.idCustomReport=parseInt(e,10)}else this.editMode=!1,this.idCustomReport=null;this.removeAnyReportNotification()}}});Tt.render=It;var xt=Tt;
/**
 * Copyright (C) InnoCraft Ltd - All rights reserved.
 *
 * NOTICE:  All information contained herein is, and remains the property of InnoCraft Ltd.
 * The intellectual and technical concepts contained herein are protected by trade secret
 * or copyright law. Redistribution of this information or reproduction of this material is
 * strictly forbidden unless prior written permission is obtained from InnoCraft Ltd.
 *
 * You shall use this code only in accordance with the license agreement obtained from
 * InnoCraft Ltd.
 *
 * @link https://www.innocraft.com/
 * @license For license details see https://www.innocraft.com/license
 */}})}));
//# sourceMappingURL=CustomReports.umd.min.js.map