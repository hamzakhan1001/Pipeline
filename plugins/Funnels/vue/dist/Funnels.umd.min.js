(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("Goals"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome","Goals",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["Funnels"]=t(require("CoreHome"),require("Goals"),require("vue"),require("CorePluginsAdmin")):e["Funnels"]=t(e["CoreHome"],e["Goals"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,n,l){return function(e){var t={};function n(l){if(t[l])return t[l].exports;var o=t[l]={i:l,l:!1,exports:{}};return e[l].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,l){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(n.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(l,o,function(t){return e[t]}.bind(null,o));return l},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="plugins/Funnels/vue/dist/",n(n.s="fae3")}({"19dc":function(t,n){t.exports=e},"6ec9":function(e,t){function n(e){return e?e.toLocaleString():"0"}function l(e){return e?e>=9995e4?"".concat(Math.round(e/1e6),"m"):e>=999500?"".concat((Math.round(e/1e5)/10).toFixed(1),"m"):e>=99950?"".concat(Math.round(e/1e3),"k"):e>=1e3?"".concat((Math.round(e/100)/10).toFixed(1),"k"):e.toString():"0"}e.exports={formatNumber:n,formatAbbr:l}},"76d2":function(e,n){e.exports=t},"8bbf":function(e,t){e.exports=n},a5a2:function(e,t){e.exports=l},fae3:function(e,t,n){"use strict";if(n.r(t),n.d(t,"ManageFunnel",(function(){return re})),n.d(t,"SalesFunnel",(function(){return Oe})),n.d(t,"FunnelPageLink",(function(){return ve})),n.d(t,"FunnelSummary",(function(){return Te})),n.d(t,"GoalFunnelReport",(function(){return wt})),n.d(t,"ManageSiteFunnels",(function(){return an})),n.d(t,"FunnelConversionReport",(function(){return ul})),"undefined"!==typeof window){var l=window.document.currentScript,o=l&&l.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);o&&(n.p=o[1])}var a=n("8bbf"),i={class:"alert alert-info"},r=Object(a["createElementVNode"])("br",null,null,-1),s=["value"],c={class:"activateFunnel"},u={class:"manageFunnel"},d={class:"stepHeading"},p={class:"funnelsTable",ref:"funnelsTable"},b=["title"],m=["title"],O={class:"stepName"},j={class:"stepPattern"},f={class:"stepRequired"},h=["title","onClick"],v=["title","onClick"],g={key:0,class:"step inactive"},F={class:"stepName"},E=Object(a["createElementVNode"])("td",null,null,-1),N=Object(a["createElementVNode"])("td",null,null,-1),y=Object(a["createElementVNode"])("td",null,null,-1),k={class:"stepRequired"},V=Object(a["createElementVNode"])("td",null,null,-1),S=Object(a["createElementVNode"])("td",null,null,-1),_=Object(a["createElementVNode"])("div",{id:"funnelValidationError"},null,-1),w={class:"tableActionBar"},B=Object(a["createElementVNode"])("span",{class:"icon-add"},null,-1),C={class:"targetValidator"},T={class:"urlField"},x={class:"loadingPiwik loadingMatchingSteps"},M=Object(a["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif",alt:""},null,-1),L={class:"ui-confirm",ref:"infoFunnelIsLocked"},D=["value"],G=["value"],R={class:"ui-confirm",ref:"cannotActivateIncompleteSteps"},A=["value"],U={class:"ui-confirm",ref:"confirmUnlockFunnel"},H=["value"],q=["value"],P={class:"ui-confirm",ref:"confirmDeactivateFunnel"},I=["value"],z=["value"];function $(e,t,n,l,o,$){var W=Object(a["resolveComponent"])("Field"),Y=Object(a["resolveComponent"])("ActivityIndicator"),X=Object(a["resolveDirective"])("content-table");return Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],null,[Object(a["withDirectives"])(Object(a["createElementVNode"])("div",i,[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("Funnels_WarningFunnelIsActivatedRequiredUnlock"))+" ",1),r,Object(a["createElementVNode"])("input",{type:"button",class:"btn unlockFunnel",onClick:t[0]||(t[0]=function(t){return e.unlockFunnel()}),value:e.translate("Funnels_Unlock")},null,8,s)],512),[[a["vShow"],e.isLocked]]),Object(a["createElementVNode"])("div",c,[e.isHideEnable?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createBlock"])(W,{key:0,uicontrol:"checkbox",name:"activateFunnel","model-value":e.funnel.activated,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.toggleFunnelActivated(t)}),"model-modifiers":{abortable:!0},title:e.translate("Funnels_EnableFunnel"),"inline-help":e.getEnableFunnelHelpText,disabled:e.isLocked},null,8,["model-value","title","inline-help","disabled"]))]),Object(a["createVNode"])(Y,{loading:e.isLoading},null,8,["loading"]),Object(a["withDirectives"])(Object(a["createElementVNode"])("div",u,[Object(a["withDirectives"])(Object(a["createElementVNode"])("div",{class:"alert alert-warning"},Object(a["toDisplayString"])(e.translate("Funnels_WarningOnUpdateReportNeedsArchiving")),513),[[a["vShow"],e.isUnlocked]]),Object(a["createElementVNode"])("h3",d,Object(a["toDisplayString"])(e.translate("Funnels_Steps")),1),Object(a["withDirectives"])(Object(a["createElementVNode"])("table",p,[Object(a["createElementVNode"])("thead",null,[Object(a["createElementVNode"])("tr",null,[Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("Funnels_Step")),1),Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("General_Name")),1),Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("Funnels_ComparisonColumnTitle")),1),Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("Funnels_Condition")),1),Object(a["createElementVNode"])("th",null,[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("Goals_Pattern"))+" ",1),Object(a["createElementVNode"])("span",{class:"icon-info header-help",title:e.translate("Funnels_PatternHelpText")},null,8,b)]),Object(a["createElementVNode"])("th",null,[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("Funnels_RequiredColumnTitle"))+" ",1),Object(a["createElementVNode"])("span",{class:"icon-info header-help required-help-icon",title:e.getRequiredHelpText},null,8,m)]),Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("General_Help")),1),Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("General_Remove")),1)])]),Object(a["createElementVNode"])("tbody",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.funnel.steps,(function(t,n){return Object(a["openBlock"])(),Object(a["createElementBlock"])("tr",{class:Object(a["normalizeClass"])("step step".concat(n+1," ").concat(e.matches[n]," ").concat(e.isLocked?"inactive":"")),key:n},[Object(a["createElementVNode"])("td",null,Object(a["toDisplayString"])(n+1),1),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",O,[Object(a["createVNode"])(W,{uicontrol:"text",placeholder:e.translate("Funnels_StepName"),name:"stepName".concat(n+1),modelValue:t.name,"onUpdate:modelValue":function(e){return t.name=e},maxlength:150,"full-width":!0,disabled:e.isLocked},null,8,["placeholder","name","modelValue","onUpdate:modelValue","disabled"])])]),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",null,[Object(a["createVNode"])(W,{uicontrol:"select",name:"patternComparison","model-value":t.patternComparison,"onUpdate:modelValue":function(l){e.updatePatternType(t.patternComparison,l,n),t.patternComparison=l,e.validateSteps()},disabled:e.isLocked,"full-width":!0,options:e.patterns},null,8,["model-value","onUpdate:modelValue","disabled","options"])])]),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",null,[Object(a["createVNode"])(W,{uicontrol:"select",name:"pattern_type","model-value":t.pattern_type,"onUpdate:modelValue":function(n){t.pattern_type=n,e.validateSteps()},disabled:e.isLocked,"full-width":!0,options:e.patternConditions(t.patternComparison)},null,8,["model-value","onUpdate:modelValue","disabled","options"])])]),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",j,[Object(a["createVNode"])(W,{uicontrol:"text","model-value":t.pattern,"onUpdate:modelValue":function(n){t.pattern=n,e.validateSteps()},name:"stepPattern".concat(n,1),maxlength:1e3,"full-width":!0,disabled:e.isLocked,placeholder:e.patternExamples[t.pattern_type],hidden:"goal"===t.patternComparison},null,8,["model-value","onUpdate:modelValue","name","disabled","placeholder","hidden"]),Object(a["createVNode"])(W,{uicontrol:"select",name:"stepPattern".concat(n,1),options:e.goals,"model-value":t.pattern,"onUpdate:modelValue":function(n){t.pattern=n,e.validateSteps()},disabled:e.isLocked,hidden:"goal"!==t.patternComparison,"full-width":!0},null,8,["name","options","model-value","onUpdate:modelValue","disabled","hidden"])])]),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",f,[Object(a["createVNode"])(W,{uicontrol:"checkbox",name:"stepRequired".concat(n,1),modelValue:t.required,"onUpdate:modelValue":function(e){return t.required=e},disabled:e.isLocked},null,8,["name","modelValue","onUpdate:modelValue","disabled"])])]),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("span",{class:"icon-info table-action",title:e.translate("Funnels_HelpStepTooltip"),onClick:function(t){return e.showHelpForStep(n)}},null,8,h)]),Object(a["createElementVNode"])("td",null,[Object(a["withDirectives"])(Object(a["createElementVNode"])("span",{class:"icon-minus table-action",title:e.translate("Funnels_RemoveStepTooltip"),onClick:function(t){return e.removeStep(n)}},null,8,v),[[a["vShow"],e.funnel.steps.length>1]])])],2)})),128)),!e.isNonGoalFunnel||e.isSalesFunnel?(Object(a["openBlock"])(),Object(a["createElementBlock"])("tr",g,[Object(a["createElementVNode"])("td",null,Object(a["toDisplayString"])(e.funnel.steps.length+1),1),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",F,[Object(a["createVNode"])(W,{uicontrol:"text",modelValue:e.getGoalName,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.getGoalName=t}),"full-width":!0,disabled:!0},null,8,["modelValue"])])]),E,N,y,Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",k,[Object(a["createVNode"])(W,{uicontrol:"checkbox",modelValue:e.isGoalRequired,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.isGoalRequired=t}),disabled:!0},null,8,["modelValue"])])]),V,S])):Object(a["createCommentVNode"])("",!0)])],512),[[a["vShow"],!e.isLoading],[X]]),_,Object(a["withDirectives"])(Object(a["createElementVNode"])("div",w,[Object(a["createElementVNode"])("button",{class:"addNewStep",onClick:t[4]||(t[4]=function(t){return e.addStep()})},[B,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_AddStep")),1)])],512),[[a["vShow"],!e.isLoading]]),Object(a["createElementVNode"])("div",C,[Object(a["createElementVNode"])("div",T,[Object(a["createVNode"])(W,{uicontrol:"text",name:"urlField",title:e.translate("Funnels_ValidateStepsOptional"),placeholder:"https://www.example.com","model-value":e.validateUrl,"onUpdate:modelValue":t[5]||(t[5]=function(t){e.validateUrl=t,e.validateSteps()}),onClick:t[6]||(t[6]=function(t){return e.prefillValidateUrl()}),"inline-help":e.getTestUrlHelpText},null,8,["title","model-value","inline-help"])]),Object(a["withDirectives"])(Object(a["createElementVNode"])("span",x,[M,Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("General_LoadingData")),1)],512),[[a["vShow"],e.isLoadingMatchingSteps]])]),Object(a["withDirectives"])(Object(a["createElementVNode"])("div",{class:"alert alert-warning"},Object(a["toDisplayString"])(e.translate("Funnels_WarningOnUpdateReportNeedsArchiving")),513),[[a["vShow"],e.isUnlocked]]),Object(a["createElementVNode"])("div",L,[Object(a["createElementVNode"])("h2",null,Object(a["toDisplayString"])(e.translate("Funnels_InfoFunnelIsLocked")),1),Object(a["createElementVNode"])("input",{role:"unlock",type:"button",value:e.translate("Funnels_Unlock")},null,8,D),Object(a["createElementVNode"])("input",{role:"ok",type:"button",value:e.translate("General_Cancel")},null,8,G)],512),Object(a["createElementVNode"])("div",R,[Object(a["createElementVNode"])("h2",null,Object(a["toDisplayString"])(e.translate("Funnels_InfoCannotActivateFunnelIncomplete")),1),Object(a["createElementVNode"])("input",{role:"ok",type:"button",value:e.translate("General_Ok")},null,8,A)],512),Object(a["createElementVNode"])("div",U,[Object(a["createElementVNode"])("h2",null,Object(a["toDisplayString"])(e.translate("Funnels_ConfirmUnlockFunnel")),1),Object(a["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,H),Object(a["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,q)],512),Object(a["createElementVNode"])("div",P,[Object(a["createElementVNode"])("h2",null,Object(a["toDisplayString"])(e.translate("Funnels_ConfirmDeactivateFunnel")),1),Object(a["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,I),Object(a["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,z)],512)],512),[[a["vShow"],e.funnel.activated]])],64)}var W=n("19dc"),Y=n("a5a2"),X=n("76d2");function K(e,t){return Z(e)||Q(e,t)||ne(e,t)||J()}function J(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Q(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var l,o,a=[],i=!0,r=!1;try{for(n=n.call(e);!(i=(l=n.next()).done);i=!0)if(a.push(l.value),t&&a.length===t)break}catch(s){r=!0,o=s}finally{try{i||null==n["return"]||n["return"]()}finally{if(r)throw o}}return a}}function Z(e){if(Array.isArray(e))return e}function ee(e){return oe(e)||le(e)||ne(e)||te()}function te(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ne(e,t){if(e){if("string"===typeof e)return ae(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ae(e,t):void 0}}function le(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function oe(e){if(Array.isArray(e))return ae(e)}function ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,l=new Array(t);n<t;n++)l[n]=e[n];return l}var ie=Object(a["defineComponent"])({props:{showGoal:Number,isHideEnable:{type:Boolean,default:!1},isSalesFunnel:{type:Boolean,default:!1},isNonGoalFunnel:{type:Boolean,default:!1},goals:{type:Array,required:!0}},components:{ActivityIndicator:W["ActivityIndicator"],Field:Y["Field"]},directives:{ContentTable:W["ContentTable"]},data:function(){return{funnel:{},isLoading:!1,patternMatchOptions:[],isLocked:!1,isUnlocked:!1,matches:{},validateUrl:"",isLoadingMatchingSteps:!1,isGoalRequired:!0}},created:function(){var e=this;this.fetchMatchingSteps=Object(W["debounce"])(this.fetchMatchingSteps,200);var t=X["ManageGoalsStore"].idGoal.value||this.showGoal;this.isNonGoalFunnel&&!this.isSalesFunnel||"number"!==typeof t||this.initGoalForm("Goals.updateGoal",t,""),W["AjaxHelper"].fetch({method:"Funnels.getAvailablePatternMatches"}).then((function(t){e.patternMatchOptions=t})),this.reset(),this.isSalesFunnel&&W["Matomo"].on("Funnels.beforeUpdateSalesFunnel",this.onSetFunnel),this.isNonGoalFunnel&&!this.isSalesFunnel&&(W["Matomo"].on("Funnels.resetForm",(function(){return e.resetForm()})),W["Matomo"].on("Funnels.initFunnelForm",this.initFunnelForm.bind(this)),W["Matomo"].on("Funnels.beforeUpdateFunnel",this.onSetFunnel)),this.isNonGoalFunnel||(W["Matomo"].on("Goals.beforeInitGoalForm",this.initGoalForm.bind(this)),W["Matomo"].on("Goals.beforeAddGoal",this.onSetFunnel.bind(this)),W["Matomo"].on("Goals.beforeUpdateGoal",this.onSetFunnel.bind(this)),W["Matomo"].on("Goals.cancelForm",(function(){return e.resetForm()})),W["Matomo"].on("Goals.goalNameChanged",this.updateGoalName.bind(this)))},updated:function(){var e=this;this.$nextTick((function(){e.isSalesFunnel?setTimeout((function(){e.scrollToFunnelsTable()}),1e3):e.scrollToFunnelsTable()}))},unmounted:function(){this.isSalesFunnel&&W["Matomo"].off("Funnels.beforeUpdateSalesFunnel",this.onSetFunnel),this.isNonGoalFunnel&&!this.isSalesFunnel&&W["Matomo"].off("Funnels.beforeUpdateFunnel",this.onSetFunnel)},methods:{testUrlMatchesSteps:W["AjaxHelper"].oneAtATime("Funnels.testUrlMatchesSteps",{errorElement:"#funnelValidationError"}),getGoalFunnel:W["AjaxHelper"].oneAtATime("Funnels.getGoalFunnel"),getFunnel:W["AjaxHelper"].oneAtATime("Funnels.getFunnel"),doUnlock:function(){this.isLocked=!1,this.isUnlocked=!0},confirmFunnelIsLocked:function(){var e=this;return new Promise((function(t){W["Matomo"].helper.modalConfirm(e.$refs.infoFunnelIsLocked,{unlock:function(){e.doUnlock(),t()}})}))},addStep:function(){var e,t=this;this.funnel&&(this.isLocked?this.confirmFunnelIsLocked().then((function(){t.addStep()})):(null!==(e=this.funnel.steps)&&void 0!==e&&e.length||(this.funnel.steps=[]),this.funnel.steps=[].concat(ee(this.funnel.steps),[{name:"",pattern:"",pattern_type:"path_equals",patternComparison:"path",required:!0}])))},removeStep:function(e){var t,n=this;if(this.funnel)if(this.isLocked)this.confirmFunnelIsLocked().then((function(){n.removeStep(e)}));else{if(e>-1&&null!==(t=this.funnel)&&void 0!==t&&t.steps){this.removeTooltipForStep(e+1);var l=ee(this.funnel.steps);l.splice(e,1),this.funnel.steps=l}this.validateSteps()}},removeTooltipForStep:function(e){var t="table.funnelsTable tr.step".concat(e," span.icon-minus"),n=document.querySelectorAll(t)[0],l=n.getAttribute("aria-describedby");if(l){var o=document.getElementById(l);o&&o.remove()}},prefillValidateUrl:function(){this.validateUrl||(this.validateUrl="https://www.")},fetchMatchingSteps:function(){var e,t,n=this,l=this.validateUrl;l&&null!==(e=this.funnel)&&void 0!==e&&null!==(t=e.steps)&&void 0!==t&&t.length&&this.stepsWithPattern.length&&(this.isLoadingMatchingSteps=!0,this.testUrlMatchesSteps({url:l},{steps:this.stepsWithPattern}).then((function(e){var t;null!==(t=n.funnel)&&void 0!==t&&t.steps&&null!==e&&void 0!==e&&e.url&&null!==e&&void 0!==e&&e.tests&&e.url===n.validateUrl&&n.funnel.steps.forEach((function(t,l){e.tests.forEach((function(e){e&&t.pattern===e.pattern&&t.pattern_type===e.pattern_type&&(n.matches[l]=e.matches?"validateMatch":"validateMismatch")}))}))})).finally((function(){n.isLoadingMatchingSteps=!1})))},cannotActivateIncompleteSteps:function(){W["Matomo"].helper.modalConfirm(this.$refs.cannotActivateIncompleteSteps,{})},validateSteps:function(){var e;this.matches={1:""},null!==(e=this.funnel.steps)&&void 0!==e&&e.length&&(this.matches=this.funnel.steps.map((function(){return"noValidation"})),this.validateUrl&&this.fetchMatchingSteps())},updatePatternType:function(e,t,n){var l=this.patternConditions(t),o=Object.keys(l)[0];if(this.funnel.steps[n].pattern_type=o,"goal"===t&&this.funnel.steps[n].patternComparison===e){var a=this.goals[0];this.funnel.steps[n].pattern=a.key}else this.funnel.steps[n].pattern=""},unlockFunnel:function(){var e=this;this.funnel&&this.isLocked&&W["Matomo"].helper.modalConfirm(this.$refs.confirmUnlockFunnel,{yes:function(){e.doUnlock()}})},toggleFunnelActivated:function(e){var t=this;if(this.funnel)return this.isLocked&&e?(e.abort(),void this.confirmFunnelIsLocked().then((function(){t.toggleFunnelActivated(e)}))):void(this.funnel.activated?W["Matomo"].helper.modalConfirm(this.$refs.confirmDeactivateFunnel,{yes:function(){t.funnel.activated=!1},no:function(){e.abort(),t.funnel.activated=!0}}):this.funnel.activated=!0)},showHelpForStep:function(e){var t,n,l=null===(t=this.funnel)||void 0===t||null===(n=t.steps)||void 0===n?void 0:n[e],o=(null===l||void 0===l?void 0:l.pattern)&&(null===l||void 0===l?void 0:l.pattern_type),a=W["MatomoUrl"].stringify({module:"Funnels",action:"stepHelp",pattern:o?l.pattern:void 0,pattern_type:o?l.pattern_type:void 0}),i=Object(W["translate"])("General_Help");Piwik_Popover.createPopupAndLoadUrl(a,i,"funnelStepHelp")},reset:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.funnel={activated:this.isNonGoalFunnel,steps:[]},this.isLocked=!1,this.isUnlocked=!1,this.matches={1:""},this.validateUrl="",e||this.addStep()},resetForm:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.reset(e),this.isLoading=!1},initGoalForm:function(e,t,n){var l=this;this.resetForm(),""!==t&&"Goals.addGoal"!==e&&(this.isLoading=!0,this.getGoalFunnel({idGoal:t}).then((function(e){e&&(l.funnel=e,l.funnel.name=l.funnel.name?l.funnel.name:n,l.funnel.steps||(l.funnel.steps=[],l.addStep()),l.funnel.activated?l.isLocked=!0:l.isLocked=!1,l.isNonGoalFunnel&&"undefined"===typeof l.funnel.idfunnel&&(l.funnel.activated=!0),l.validateSteps())})).finally((function(){l.isLoading=!1})))},initFunnelForm:function(e,t){var n=this;this.resetForm(t>0),0!==t&&(this.isLoading=!0,setTimeout((function(){n.getFunnel({idSite:e,idFunnel:t}).then((function(e){e&&(n.funnel=e,n.funnel.steps||(n.funnel.steps=[],n.addStep()),n.funnel.activated?n.isLocked=!0:n.isLocked=!1,n.validateSteps())})).finally((function(){n.isLoading=!1}))}),500))},onSetFunnel:function(e){var t,n=this,l=e.parameters,o=e.options;if(!this.funnel||this.isLocked&&(this.isSalesFunnel||this.isNonGoalFunnel))return l.isLocked=this.isLocked,void(l.cancelRequest=!0);if(this.funnel.activated&&(null===(t=this.funnel.steps)||void 0===t||!t.length))return this.cannotActivateIncompleteSteps(),void(l.cancelRequest=!0);var a=this.funnel.steps.some((function(e){return n.isStepIncomplete(e)}));if(this.funnel.activated&&a)return this.cannotActivateIncompleteSteps(),void(l.cancelRequest=!0);o.postParams=Object.assign(Object.assign({},o.postParams),{},{funnelSteps:this.stepsWithNameAndPattern,funnelActivated:this.funnel.activated?"1":"0"}),this.isNonGoalFunnel&&(o.postParams=Object.assign(Object.assign({},o.postParams),{},{steps:this.stepsWithNameAndPattern,isActivated:this.funnel.activated?"1":"0"}),!this.isSalesFunnel&&o.postParams.steps.length&&(o.postParams.steps[o.postParams.steps.length-1].required=1))},isStepIncomplete:function(e){return!e.name||!e.name.trim()||!e.pattern||!e.pattern.trim()},updateGoalName:function(e){this.funnel.name=e},scrollToFunnelsTable:function(){var e=this.$refs.funnelsTable,t=Object.assign({},W["MatomoUrl"].hashParsed.value);t.scrollToFunnel&&e&&(delete t.scrollToFunnel,e.scrollIntoView())},patternConditions:function(e){var t={};return Object.entries(this.patternMatchOptions).forEach((function(n){var l=K(n,2),o=l[0],a=l[1];o===e&&Object.values(a.conditions).forEach((function(e){t[e.key]=e.value}))})),t}},computed:{patternExamples:function(){var e={};return Object.values(this.patternMatchOptions).forEach((function(t){Object.values(t.conditions).forEach((function(t){e[t.key]=t.example}))})),e},patterns:function(){var e={};return Object.entries(this.patternMatchOptions).forEach((function(t){var n=K(t,2),l=n[0],o=n[1];e[l]=o.comparisonName})),e},stepsWithPattern:function(){var e;return null!==(e=this.funnel.steps)&&void 0!==e&&e.length?this.funnel.steps.filter((function(e){return e&&e.pattern&&e.pattern_type})).map((function(e){return Object.assign(Object.assign({},e),{},{required:e.required?1:0})})):[]},stepsWithNameAndPattern:function(){var e=this.stepsWithPattern;return e=e.filter((function(e){return e.name})),e},getEnableFunnelHelpText:function(){var e='<a target="_blank" rel="noreferrer noopener" href="https://matomo.org/faq/funnels/faq_22793/">';return Object(W["translate"])("Funnels_EnableFunnelHelpText",e,"</a>")},getGoalName:function(){return this.isSalesFunnel?Object(W["translate"])("Ecommerce_Sales"):this.funnel.name?this.funnel.name:Object(W["translate"])("Goals_GoalName")},getTestUrlHelpText:function(){var e=Object(W["translate"])("Funnels_TestUrlHelpText"),t=Object(W["translate"])("Funnels_TestUrlHelpTextGoalComparison","<i>","</i>");return"".concat(e," ").concat(t)},getRequiredHelpText:function(){var e=Object(W["translate"])("Funnels_RequiredStepsHelpTextNote","<br><br><strong>","</strong>");return Object(W["translate"])("Funnels_RequiredStepsHelpTextNew")+e}}});ie.render=$;var re=ie,se=Object(a["createElementVNode"])("span",{class:"icon-show"},null,-1),ce=Object(a["createElementVNode"])("br",null,null,-1),ue=Object(a["createElementVNode"])("br",null,null,-1),de={class:"ui-confirm",ref:"funnelIsLockedCannotBeSaved"},pe=["value"];function be(e,t,n,l,o,i){var r=Object(a["resolveComponent"])("SaveButton"),s=Object(a["resolveComponent"])("ManageFunnel");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",null,[Object(a["createVNode"])(r,{class:"toggleEditSalesFunnel",value:e.translate("Funnels_EditSalesFunnel"),disabled:e.showEditForm,onConfirm:t[0]||(t[0]=function(t){return e.showEditForm=!e.showEditForm}),saving:e.isLoading},null,8,["value","disabled","saving"]),e.idFunnel?(Object(a["openBlock"])(),Object(a["createElementBlock"])("a",{key:0,class:"btn",onClick:t[1]||(t[1]=Object(a["withModifiers"])((function(t){return e.openFunnelReport(e.idFunnel)}),["prevent"])),style:{"margin-left":"3.5px"}},[se,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_ViewSalesFunnelReport")),1)])):Object(a["createCommentVNode"])("",!0),Object(a["withDirectives"])(Object(a["createElementVNode"])("div",null,[ce,ue,Object(a["createVNode"])(s,{"show-goal":0,"is-sales-funnel":!0,"is-non-goal-funnel":!0,goals:e.goals},null,8,["goals"]),Object(a["createVNode"])(r,{class:"saveSalesFunnel",onConfirm:t[2]||(t[2]=function(t){return e.save()}),saving:e.isLoading},null,8,["saving"]),Object(a["createElementVNode"])("div",de,[Object(a["createElementVNode"])("h3",null,Object(a["toDisplayString"])(e.translate("Funnels_FunnelIsLockedCannotBeSaved")),1),Object(a["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Ok")},null,8,pe)],512)],512),[[a["vShow"],e.showEditForm]])])}var me=Object(a["defineComponent"])({props:{idFunnel:{type:[String,Number],required:!1,default:0},isFunnelEdit:{type:Boolean,required:!1,default:!1},goals:{type:Array,required:!0}},components:{SaveButton:Y["SaveButton"],ManageFunnel:re},data:function(){return{isLoading:!1,showEditForm:!1}},methods:{openFunnelReport:function(e){W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Funnels_Funnels",subcategory:e}))},save:function(){var e=this,t={method:"Funnels.setGoalFunnel",idGoal:"0"},n={};W["Matomo"].postEvent("Funnels.beforeUpdateSalesFunnel",{parameters:t,options:n}),t&&t.isLocked&&this.$refs.funnelIsLockedCannotBeSaved?W["Matomo"].helper.modalConfirm(this.$refs.funnelIsLockedCannotBeSaved,{}):t.cancelRequest||(this.isLoading=!0,W["AjaxHelper"].fetch(t,n).then((function(){window.location.reload()})).catch((function(){e.isLoading=!1})))}},mounted:function(){this.isFunnelEdit&&(this.showEditForm=!0)}});me.render=be;var Oe=me,je=window,fe=je.$,he={mounted:function(e,t){if(W["Matomo"].helper.isReportingPage()){var n=fe(e);if("a"!==e.tagName.toLowerCase()){var l=fe(e).text();fe(e).html("<a></a>"),n=fe(e).find("a"),n.text(l)}n.bind("click",(function(e){e.preventDefault(),W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Funnels_Funnels",subcategory:t.value.idFunnel}))}))}}},ve=he;
/**
 * Copyright (C) InnoCraft Ltd - All rights reserved.
 *
 * NOTICE:  All information contained herein is, and remains the property of InnoCraft Ltd.
 * The intellectual and technical concepts contained herein are protected by trade secret
 * or copyright law. Redistribution of this information or reproduction of this material is
 * strictly forbidden unless prior written permission is obtained from InnoCraft Ltd.
 *
 * You shall use this code only in accordance with the license agreement obtained from
 * InnoCraft Ltd.
 *
 * @link https://www.innocraft.com/
 * @license For license details see https://www.innocraft.com/license
 */W["Matomo"].on("Matomo.processDynamicHtml",(function(e){e.find("[piwik-funnel-page-link]").each((function(e,t){if(!fe(t).attr("piwik-funnel-page-link-handled")){var n=fe(t).attr("piwik-funnel-page-link");n&&he.mounted(t,{instance:null,value:{idFunnel:n},oldValue:null,modifiers:{},dir:{}}),fe(t).attr("piwik-funnel-page-link-handled","1")}}))}));var ge={class:"funnelsReport"},Fe={class:"funnelSummary"},Ee={key:0},Ne=Object(a["createElementVNode"])("span",{class:"icon-visitor-profile funnelOverviewLink"},null,-1),ye={key:1},ke=Object(a["createElementVNode"])("span",{class:"icon-reporting-goal funnelOverviewLink"},null,-1),Ve={key:2},Se=Object(a["createElementVNode"])("span",{class:"icon-edit funnelOverviewLink"},null,-1);function _e(e,t,n,l,o,i){var r=Object(a["resolveComponent"])("ContentBlock");return Object(a["openBlock"])(),Object(a["createBlock"])(r,{"content-title":e.$sanitize(e.funnel.name)},{default:Object(a["withCtx"])((function(){return[Object(a["createElementVNode"])("div",ge,[Object(a["createElementVNode"])("div",Fe,[e.isVisitorLogEnabled?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",Ee,[Object(a["createElementVNode"])("a",{class:"funnelOverviewLink",onClick:t[0]||(t[0]=Object(a["withModifiers"])((function(t){return e.openSegmentedVisitorLog()}),["prevent"]))},[Ne,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_ShowFunnelVisitsLog")),1)])])):Object(a["createCommentVNode"])("",!0),e.funnel.idgoal>0?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",ye,[Object(a["createElementVNode"])("a",{class:"funnelOverviewLink",onClick:t[1]||(t[1]=Object(a["withModifiers"])((function(t){return e.openGoalReport()}),["prevent"]))},[ke,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_ShowGoalReport")),1)])])):Object(a["createCommentVNode"])("",!0),e.userCanEditFunnels?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",Ve,[Object(a["createElementVNode"])("a",{onClick:t[2]||(t[2]=Object(a["withModifiers"])((function(t){return e.editFunnel()}),["prevent"])),class:"funnelOverviewLink"},[Se,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_EditFunnel")),1)])])):Object(a["createCommentVNode"])("",!0)])])]})),_:1},8,["content-title"])}var we=window,Be=we.SegmentedVisitorLog,Ce=Object(a["defineComponent"])({props:{funnel:{type:Object,required:!0},goalsSummary:Object,isVisitorLogEnabled:Boolean,segment:String,patternTranslations:{type:Object,required:!0},funnelFlow:{type:Object,required:!0},isNonGoalFunnel:{type:Boolean,required:!1,default:!1},userCanEditFunnels:{type:Boolean,required:!1,default:!1}},components:{ContentBlock:W["ContentBlock"]},directives:{ContentTable:W["ContentTable"]},methods:{openSegmentedVisitorLog:function(){Be.show("Funnel.getFunnelFlow","funnels_name==".concat(this.funnel.idfunnel).concat(this.segment?";".concat(this.segment):""),{})},openGoalReport:function(){W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Goals_Goals",subcategory:this.funnel.idgoal}))},editFunnel:function(){var e=this.funnel;e.idgoal&&"0"!==e.idgoal?W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Goals_Goals",subcategory:"Goals_ManageGoals",idGoal:e.idgoal,scrollToFunnel:1})):e.isSalesFunnel?W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Goals_Ecommerce",subcategory:"General_Overview",isFunnelEdit:!0,scrollToFunnel:1})):W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Funnels_Funnels",subcategory:"Funnels_ManageFunnels",idFunnel:e.idfunnel}))}}});Ce.render=_e;var Te=Ce,xe={key:0,class:"reportFlow"},Me=Object(a["createElementVNode"])("thead",null,[Object(a["createElementVNode"])("tr",null,[Object(a["createElementVNode"])("th",{class:"funnelEntries"}),Object(a["createElementVNode"])("th",{class:"separator"}),Object(a["createElementVNode"])("th",{class:"funnelFlow"}),Object(a["createElementVNode"])("th",{class:"separator"}),Object(a["createElementVNode"])("th",{class:"funnelExits"})])],-1),Le={key:1},De=Object(a["createElementVNode"])("br",null,null,-1),Ge={key:0},Re={key:1};function Ae(e,t,n,l,o,i){var r=Object(a["resolveComponent"])("EnrichedHeadline"),s=Object(a["resolveComponent"])("FunnelFlowRow"),c=Object(a["resolveComponent"])("ContentBlock");return Object(a["openBlock"])(),Object(a["createBlock"])(c,{class:"funnelsReport"},{default:Object(a["withCtx"])((function(){return[Object(a["createElementVNode"])("h2",null,[Object(a["createVNode"])(r,{"feature-name":"Funnels","inline-help":e.translate("Funnels_GoalFunnelReportHelp")},{default:Object(a["withCtx"])((function(){return[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("Funnels_GoalFunnelReport")),1)]})),_:1},8,["inline-help"])]),e.funnelFlow.length?(Object(a["openBlock"])(),Object(a["createElementBlock"])("table",xe,[Me,Object(a["createElementVNode"])("tbody",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.funnelFlow,(function(t,n){return Object(a["openBlock"])(),Object(a["createBlock"])(s,{key:n,row:t,"is-last-row":n===e.funnelFlow.length-1,"id-site":e.idSite,funnel:e.funnel,"is-visitor-log-enabled":e.isVisitorLogEnabled,segment:e.segment},null,8,["row","is-last-row","id-site","funnel","is-visitor-log-enabled","segment"])})),128))])])):(Object(a["openBlock"])(),Object(a["createElementBlock"])("p",Le,[Object(a["createElementVNode"])("strong",null,Object(a["toDisplayString"])(e.translate("CoreHome_ThereIsNoDataForThisReport")),1),De,e.hasBeenPurged?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",Ge,Object(a["toDisplayString"])(e.translate("CoreHome_DataForThisReportHasBeenPurged",e.deleteReportsOlderThan)),1)):(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",Re,Object(a["toDisplayString"])(e.translate("Funnels_FunnelReportNotGeneratedYet")),1))]))]})),_:1})}var Ue={colspan:"5",class:"stepLabel"},He=["title"],qe=["title"],Pe=Object(a["createElementVNode"])("span",{class:"icon-visitor-profile",style:{visibility:"hidden"}},null,-1),Ie={key:0,class:"icon-evolution",style:{visibility:"hidden"}},ze={key:1},$e={key:2},We=["title"],Ye=Object(a["createElementVNode"])("span",{class:"icon-visitor-profile segmentVisitorsByFunnelStep"},null,-1),Xe=[Ye],Ke=["title"],Je=Object(a["createElementVNode"])("span",{class:"icon-evolution"},null,-1),Qe=[Je],Ze={class:"funnelEntries"},et=Object(a["createElementVNode"])("br",null,null,-1),tt=Object(a["createElementVNode"])("td",{class:"separator"},[Object(a["createElementVNode"])("h4",{class:"entryArrow"},"→")],-1),nt={class:"funnelFlow"},lt={key:0},ot=["title"],at=Object(a["createElementVNode"])("br",null,null,-1),it=Object(a["createElementVNode"])("span",{class:"proceededArrow"},"↓",-1),rt=Object(a["createElementVNode"])("br",null,null,-1),st=["innerHTML"],ct=Object(a["createElementVNode"])("br",null,null,-1),ut={key:1},dt=["title"],pt=Object(a["createElementVNode"])("br",null,null,-1),bt=Object(a["createElementVNode"])("span",{class:"proceededArrow"},"↓",-1),mt=Object(a["createElementVNode"])("br",null,null,-1),Ot=Object(a["createElementVNode"])("br",null,null,-1),jt={class:"proceededRate"},ft={class:"separator"},ht={key:0,class:"exitArrow"},vt={class:"funnelExits"},gt={key:0},Ft=Object(a["createElementVNode"])("br",null,null,-1);function Et(e,t,n,l,o,i){var r=Object(a["resolveComponent"])("WidgetLoader");return Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],null,[Object(a["createElementVNode"])("tr",{class:Object(a["normalizeClass"])("step".concat(e.row.step_position))},[Object(a["createElementVNode"])("td",Ue,[Object(a["createElementVNode"])("h3",{class:"stepName",title:e.row.step_definition},Object(a["toDisplayString"])(e.row.label),9,He),Object(a["createElementVNode"])("h3",{class:"stepMetric",title:e.row.step_nb_visits!==e.row.step_nb_visits_actual?e.translate("Funnels_HitsWereBackfilled",e.row.step_nb_visits_actual):e.translate("Funnels_HitsWereNotBackfilled")},[Pe,e.isLastRow?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",Ie)),1===e.row.step_nb_visits?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",ze,Object(a["toDisplayString"])(e.isLastRow?e.translate("Funnels_NbConversion",1):e.translate("General_OneVisit")),1)):(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",$e,Object(a["toDisplayString"])(e.isLastRow?e.translate("Goals_Conversions",e.row.step_nb_visits):e.translate("General_NVisits",e.row.step_nb_visits)),1)),e.isVisitorLogEnabled?(Object(a["openBlock"])(),Object(a["createElementBlock"])("a",{key:3,href:"",title:e.translate("Funnels_SegmentVisitorsByThisFunnelStep"),class:"segmentVisitors",onClick:t[0]||(t[0]=Object(a["withModifiers"])((function(t){return e.openSegmentedVisitorLog(e.row.step_position)}),["prevent"]))},Xe,8,We)):Object(a["createCommentVNode"])("",!0),e.isLastRow?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("a",{key:4,href:"",title:e.translate("General_RowEvolutionRowActionTooltipTitle"),class:"rowEvolutionByFunnelStep",onClick:t[1]||(t[1]=Object(a["withModifiers"])((function(t){return e.openRowEvolution(e.row.label)}),["prevent"]))},Qe,8,Ke))],8,qe)])],2),Object(a["createElementVNode"])("tr",{class:Object(a["normalizeClass"])("step".concat(e.row.step_position))},[Object(a["createElementVNode"])("td",Ze,[Object(a["createElementVNode"])("h4",null,Object(a["toDisplayString"])(1===e.row.step_nb_entries?e.translate("Funnels_NbEntry",1):e.translate("Funnels_NbEntries",e.row.step_nb_entries)),1),et,e.row.step_nb_entries?(Object(a["openBlock"])(),Object(a["createBlock"])(r,{key:0,class:"actionReportContainer","widget-params":{module:"Funnels",action:"getFunnelEntries",viewDataTable:"table",idSite:e.idSite,widget:1,disableLink:1,showtitle:0,idFunnel:e.funnel.idfunnel,step:e.row.step_position}},null,8,["widget-params"])):Object(a["createCommentVNode"])("",!0)]),tt,Object(a["createElementVNode"])("td",nt,[e.isLastRow?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",lt,[Object(a["createElementVNode"])("div",{title:e.translate("Funnels_XVisitorsConvertedFunnel",e.funnel.conversionRate),class:"progressOuter"},[e.funnel.conversionRate?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:0,class:"progressInner",style:Object(a["normalizeStyle"])({width:e.funnel.conversionRate})},null,4)):Object(a["createCommentVNode"])("",!0)],8,ot),at,it,rt,Object(a["createElementVNode"])("span",{class:"proceededRate",innerHTML:e.$sanitize(e.translate("Goals_ConversionRate","".concat(e.funnel.conversionRate,"<br />")))},null,8,st),ct,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_XoutOfYVisitsconverted",e.funnel.numConversions,e.funnel.numEntries)),1)])):(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",ut,[Object(a["createElementVNode"])("div",{title:"".concat(e.row.step_proceeded_rate," proceeded to the next step"),class:"progressOuter"},[e.row.step_proceeded_rate?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:0,class:"progressInner",style:Object(a["normalizeStyle"])({width:e.row.step_proceeded_rate})},null,4)):Object(a["createCommentVNode"])("",!0)],8,dt),pt,bt,mt,Object(a["createElementVNode"])("div",null,[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("Funnels_NbProceeded",e.row.step_nb_proceeded))+" ",1),Ot,Object(a["createElementVNode"])("span",jt,Object(a["toDisplayString"])(e.row.step_proceeded_rate),1)])]))]),Object(a["createElementVNode"])("td",ft,[e.isLastRow?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("h4",ht,"→"))]),Object(a["createElementVNode"])("td",vt,[e.isLastRow?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",gt,[Object(a["createElementVNode"])("h4",null,Object(a["toDisplayString"])(1===e.row.step_nb_exits||"1"===e.row.step_nb_exits?e.translate("Funnels_NbExit",1):e.translate("Funnels_NbExits",e.row.step_nb_exits)),1),Ft,e.row.step_nb_exits?(Object(a["openBlock"])(),Object(a["createBlock"])(r,{key:0,class:"actionReportContainer","widget-params":{module:"Funnels",action:"getFunnelExits",viewDataTable:"table",idSite:e.idSite,widget:1,showtitle:0,disableLink:1,idFunnel:e.funnel.idfunnel,step:e.row.step_position}},null,8,["widget-params"])):Object(a["createCommentVNode"])("",!0)]))])],2)],64)}var Nt=window,yt=Nt.DataTable_RowActions_RowEvolution,kt=Nt.SegmentedVisitorLog,Vt=Object(a["defineComponent"])({props:{row:{type:Object,required:!0},funnel:{type:Object,required:!0},isLastRow:Boolean,isVisitorLogEnabled:Boolean,idSite:{type:[Number,String],required:!0},segment:String},components:{WidgetLoader:W["WidgetLoader"]},methods:{openSegmentedVisitorLog:function(e){var t=this.segment?";".concat(this.segment):"";kt.show("Funnel.getFunnelFlow","funnels_name==".concat(this.funnel.idfunnel,";funnels_step_position==").concat(e).concat(t),{})},openRowEvolution:function(e){(new yt).showRowEvolution("Funnels.getFunnelFlow",e,{idGoal:this.funnel.idgoal,idFunnel:this.funnel.idfunnel})}}});Vt.render=Et;var St=Vt,_t=Object(a["defineComponent"])({props:{funnel:{type:Object,required:!0},funnelFlow:{type:Array,required:!0},hasBeenPurged:Boolean,deleteReportsOlderThan:[Number,String],segment:String,idSite:{type:[Number,String],required:!0},isVisitorLogEnabled:Boolean},components:{ContentBlock:W["ContentBlock"],EnrichedHeadline:W["EnrichedHeadline"],FunnelFlowRow:St}});_t.render=Ae;var wt=_t,Bt={class:"manageSiteFunnels"},Ct={key:0,class:"addNewNoEdit"},Tt={class:"listFunnels"},xt={class:"contentHelp"},Mt={class:"first"},Lt={key:0},Dt={key:0},Gt={colspan:"4"},Rt=Object(a["createElementVNode"])("br",null,null,-1),At=Object(a["createElementVNode"])("br",null,null,-1),Ut=Object(a["createElementVNode"])("br",null,null,-1),Ht=["id"],qt={class:"first"},Pt=["title"],It={key:1},zt={key:0,style:{"padding-top":"2px"}},$t=["onClick","title"],Wt=["onClick","title"],Yt={key:0,class:"tableActionBar"},Xt=Object(a["createElementVNode"])("span",{class:"icon-add"},null,-1),Kt={key:1},Jt=["innerHTML"],Qt={class:"ui-confirm",ref:"confirm"},Zt=["value"],en=["value"],tn={class:"ui-confirm",ref:"funnelIsLockedCannotBeSaved"},nn=["value"];function ln(e,t,n,l,o,i){var r,s=Object(a["resolveComponent"])("ContentBlock"),c=Object(a["resolveComponent"])("ActivityIndicator"),u=Object(a["resolveComponent"])("Field"),d=Object(a["resolveComponent"])("ManageFunnel"),p=Object(a["resolveComponent"])("SaveButton"),b=Object(a["resolveDirective"])("content-table"),m=Object(a["resolveDirective"])("form");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",Bt,[e.isAddNewView&&!e.userCanEditFunnels?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",Ct,[Object(a["createVNode"])(s,{"content-title":e.getEditFunnelHeader},{default:Object(a["withCtx"])((function(){return[Object(a["createElementVNode"])("p",null,Object(a["toDisplayString"])(e.translate("Funnels_AddNewUserUnableToEdit")),1)]})),_:1},8,["content-title"])])):Object(a["createCommentVNode"])("",!0),Object(a["withDirectives"])(Object(a["createElementVNode"])("div",Tt,[Object(a["createVNode"])(s,{"content-title":e.translate("Funnels_ManageFunnels")},{default:Object(a["withCtx"])((function(){return[Object(a["createVNode"])(c,{loading:e.isLoading},null,8,["loading"]),Object(a["createElementVNode"])("div",xt,Object(a["toDisplayString"])(e.translate("Funnels_Introduction")),1),Object(a["withDirectives"])(Object(a["createElementVNode"])("table",null,[Object(a["createElementVNode"])("thead",null,[Object(a["createElementVNode"])("tr",null,[Object(a["createElementVNode"])("th",Mt,Object(a["toDisplayString"])(e.translate("General_Id")),1),Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("Funnels_FunnelName")),1),Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("Goals_GoalConversion")),1),e.userCanEditFunnels?(Object(a["openBlock"])(),Object(a["createElementBlock"])("th",Lt,Object(a["toDisplayString"])(e.translate("General_Actions")),1)):Object(a["createCommentVNode"])("",!0)])]),Object(a["createElementVNode"])("tbody",null,[Object.keys(e.funnels||{}).length?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("tr",Dt,[Object(a["createElementVNode"])("td",Gt,[Rt,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_ThereIsNoFunnelToManage",e.siteName))+" ",1),At,Ut])])),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.funnels||[],(function(t){return Object(a["openBlock"])(),Object(a["createElementBlock"])("tr",{id:t.idfunnel,key:t.idfunnel},[Object(a["createElementVNode"])("td",qt,Object(a["toDisplayString"])(t.idfunnel),1),Object(a["createElementVNode"])("td",null,Object(a["toDisplayString"])(t.name),1),Object(a["createElementVNode"])("td",null,[t.idgoal&&0!==Number(t.idgoal)||t.isSalesFunnel?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",{key:0,class:"icon-ok system-success",title:e.$sanitize(e.translate("Funnels_GoalCheckHover",t.name))},null,8,Pt)):(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",It,"-"))]),e.userCanEditFunnels?(Object(a["openBlock"])(),Object(a["createElementBlock"])("td",zt,[e.userCanEditFunnels?(Object(a["openBlock"])(),Object(a["createElementBlock"])("button",{key:0,onClick:function(n){return e.editFunnel(t.idfunnel)},class:"table-action icon-edit",title:e.translate("General_Edit")},null,8,$t)):Object(a["createCommentVNode"])("",!0),e.userCanEditFunnels?(Object(a["openBlock"])(),Object(a["createElementBlock"])("button",{key:1,onClick:function(n){return e.deleteFunnel(t.idfunnel)},class:"table-action icon-delete",title:e.translate("General_Delete")},null,8,Wt)):Object(a["createCommentVNode"])("",!0)])):Object(a["createCommentVNode"])("",!0)],8,Ht)})),128))])],512),[[b]]),e.userCanEditFunnels?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",Yt,[Object(a["createElementVNode"])("button",{id:"addFunnel",onClick:t[0]||(t[0]=function(t){return e.createFunnel()})},[Xt,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_AddNewFunnel")),1)])])):Object(a["createCommentVNode"])("",!0)]})),_:1},8,["content-title"])],512),[[a["vShow"],e.showFunnelList&&!e.isAddNewView]]),e.userCanEditFunnels?Object(a["withDirectives"])((Object(a["openBlock"])(),Object(a["createElementBlock"])("div",Kt,[Object(a["createVNode"])(s,{"content-title":e.getEditFunnelHeader},{default:Object(a["withCtx"])((function(){return[Object(a["withDirectives"])(Object(a["createElementVNode"])("div",null,[Object(a["createElementVNode"])("div",null,[Object(a["createVNode"])(u,{uicontrol:"text",name:"funnelName",modelValue:e.funnelName,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.funnelName=t}),maxlength:50,title:e.translate("Funnels_FunnelName"),"inline-help":e.translate("Funnels_FunnelNameHelp")},null,8,["modelValue","title","inline-help"])]),Object(a["createVNode"])(d,{"is-non-goal-funnel":!0,"show-goal":0,"is-hide-enable":!0,goals:e.goals},null,8,["goals"]),Object(a["createVNode"])(p,{saving:e.isLoading,onConfirm:t[2]||(t[2]=function(t){return e.save()}),value:e.getSubmitText,class:"saveBtn"},null,8,["saving","value"]),e.isAddNewView?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:0,class:"entityCancel",onClick:t[3]||(t[3]=function(t){return e.showListOfFunnels()}),innerHTML:e.$sanitize(e.cancelText)},null,8,Jt))],512),[[m]])]})),_:1},8,["content-title"]),Object(a["createElementVNode"])("div",Qt,[Object(a["createElementVNode"])("h2",null,Object(a["toDisplayString"])(e.translate("Funnels_DeleteFunnelConfirm",'"'.concat(null===(r=e.funnelToDelete)||void 0===r?void 0:r.name,'"'))),1),Object(a["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,Zt),Object(a["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,en)],512),Object(a["createElementVNode"])("div",tn,[Object(a["createElementVNode"])("h3",null,Object(a["toDisplayString"])(e.translate("Funnels_FunnelIsLockedCannotBeSaved")),1),Object(a["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Ok")},null,8,nn)],512)],512)),[[a["vShow"],e.showEditFunnel||e.isAddNewView]]):Object(a["createCommentVNode"])("",!0)])}var on=Object(a["defineComponent"])({props:{userCanEditFunnels:Boolean,isAddNewView:{type:Boolean,default:!1},siteId:{type:Number,required:!0},siteName:{type:String,required:!0},funnels:{type:Object,required:!0},funnelId:{type:Number,required:!1,default:0},goals:{type:Array,required:!0}},data:function(){return{showEditFunnel:!1,showFunnelList:!0,isLoading:!1,idFunnel:0,funnelName:"",funnelToDelete:null}},components:{Field:Y["Field"],SaveButton:Y["SaveButton"],ContentBlock:W["ContentBlock"],ActivityIndicator:W["ActivityIndicator"],ManageFunnel:re},directives:{ContentTable:W["ContentTable"],Form:Y["Form"]},methods:{scrollToTop:function(){setTimeout((function(){W["Matomo"].helper.lazyScrollTo(".pageWrap",200)}))},editFunnel:function(e){var t=this.funnels.find((function(t){return Number(t.idfunnel)===Number(e)}));t.idgoal&&"0"!==t.idgoal&&W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Goals_Goals",subcategory:"Goals_ManageGoals",idGoal:t.idgoal,scrollToFunnel:1})),t.isSalesFunnel&&W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Goals_Ecommerce",subcategory:"General_Overview",isFunnelEdit:!0,scrollToFunnel:1})),W["Matomo"].postEvent("Funnels.initFunnelForm",this.siteId,e),this.showFunnelList=!1,this.showEditFunnel=!0,this.idFunnel=e,this.funnelName=t.name},deleteFunnel:function(e){var t=this;this.funnelToDelete=this.funnels.find((function(t){return t.idfunnel===e})),W["Matomo"].helper.modalConfirm(this.$refs.confirm,{yes:function(){t.isLoading=!0,W["AjaxHelper"].fetch({idSite:t.siteId,idFunnel:e,method:"Funnels.deleteNonGoalFunnel"}).then((function(){window.location.reload()})).finally((function(){t.isLoading=!1}))}})},createFunnel:function(){this.idFunnel=0,this.funnelName="",W["Matomo"].postEvent("Funnels.resetForm",{}),this.showFunnelList=!1,this.showEditFunnel=!0},showListOfFunnels:function(){this.showFunnelList=!0,this.showEditFunnel=!1,this.scrollToTop()},save:function(){var e=this,t={method:"Funnels.saveNonGoalFunnel",idFunnel:this.idFunnel,funnelName:this.funnelName},n={};W["Matomo"].postEvent("Funnels.beforeUpdateFunnel",{parameters:t,options:n}),t&&t.isLocked&&this.$refs.funnelIsLockedCannotBeSaved?W["Matomo"].helper.modalConfirm(this.$refs.funnelIsLockedCannotBeSaved,{}):t.cancelRequest||W["AjaxHelper"].fetch(t,n).then((function(){var t=W["MatomoUrl"].parsed.value.subcategory;"Funnels_AddNewFunnel"===t&&W["Matomo"].helper.isReportingPage()?W["ReportingMenuStore"].reloadMenuItems().then((function(){W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{subcategory:"Funnels_ManageFunnels"})),e.isLoading=!1})):window.location.reload()})).catch((function(){e.scrollToTop(),e.isLoading=!1}))}},computed:{getEditFunnelHeader:function(){return 0===this.idFunnel?Object(W["translate"])("Funnels_AddNewFunnel"):Object(W["translate"])("Funnels_UpdateFunnel")},getSubmitText:function(){return 0===this.idFunnel?Object(W["translate"])("Funnels_AddFunnel"):Object(W["translate"])("Funnels_UpdateFunnel")},cancelText:function(){return Object(W["translate"])("General_OrCancel","<a class='entityCancelLink'>","</a>")}},mounted:function(){var e=this;this.funnelId>0&&Object(a["nextTick"])((function(){e.editFunnel(e.funnelId)}))}});on.render=ln;var an=on,rn={class:"funnelReport"},sn={class:"funnelReportHeader"},cn={key:0,class:"legend"},un=["title"],dn=Object(a["createElementVNode"])("div",{class:"colorBoxSplit"},null,-1),pn={class:"text"},bn={class:"title"},mn={key:0,class:"subtitle"},On={key:1,class:"items"},jn={key:0,class:"item"},fn=Object(a["createElementVNode"])("div",{class:"colorBoxProceeded"},null,-1),hn={class:"text"},vn={class:"title"},gn={key:1,class:"item"},Fn=Object(a["createElementVNode"])("div",{class:"colorBoxEntries"},null,-1),En={class:"text"},Nn={class:"title"},yn={key:2,class:"item"},kn=Object(a["createElementVNode"])("div",{class:"colorBoxSkipped"},null,-1),Vn={class:"text"},Sn={class:"title"},_n={key:3,class:"item"},wn=Object(a["createElementVNode"])("div",{class:"colorBoxExits"},null,-1),Bn={class:"text"},Cn={class:"title"},Tn={key:0,id:"funnelConversionTable"},xn={class:"stepTitle"},Mn={class:"stepLabel"},Ln={class:"cellLabel"},Dn={class:"metricCount"},Gn={class:"barsContainer"},Rn={class:"barStep"},An=["onMouseenter","onMousemove","onMouseleave"],Un=["onMouseenter","onMousemove","onMouseleave"],Hn=["onMouseenter","onMousemove","onMouseleave"],qn=["onMouseenter","onMousemove","onMouseleave"],Pn={class:"cellLabel"},In={class:"metricCount"},zn={class:"metricRate"},$n={key:1},Wn=Object(a["createElementVNode"])("br",null,null,-1);function Yn(e,t,n,l,o,i){var r=Object(a["resolveComponent"])("EnrichedHeadline"),s=Object(a["resolveComponent"])("ContentBlock"),c=Object(a["resolveComponent"])("Tooltip");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",rn,[Object(a["createVNode"])(s,null,{default:Object(a["withCtx"])((function(){return[Object(a["createElementVNode"])("div",sn,[Object(a["createElementVNode"])("h2",null,[Object(a["createVNode"])(r,{"feature-name":"Funnels","inline-help":e.getFunnelReportHelpText},{default:Object(a["withCtx"])((function(){return[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("Funnels_FunnelReport")),1)]})),_:1},8,["inline-help"])]),e.getFunnelSteps.length?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",cn,[e.metadata.has_multiple_valid_segments?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:0,class:"items",style:Object(a["normalizeStyle"])(e.metadata.has_period_comparison?"grid-template-columns: repeat(".concat(e.columnsPerRow,", auto);"):"grid-template-columns: repeat(3, auto);")},[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.metadata.segments,(function(t,n){return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{class:"item",key:n,title:e.parseLegendText(n).hover},[dn,Object(a["createElementVNode"])("div",pn,[Object(a["createElementVNode"])("span",bn,Object(a["toDisplayString"])(e.parseLegendText(n).title),1),e.metadata.has_period_comparison?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",mn,Object(a["toDisplayString"])(e.parseLegendText(n).subtitle),1)):Object(a["createCommentVNode"])("",!0)])],8,un)})),128))],4)):(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",On,[e.metadata.has_proceeded?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",jn,[fn,Object(a["createElementVNode"])("div",hn,[Object(a["createElementVNode"])("span",vn,Object(a["toDisplayString"])(e.translate("Funnels_Progressions")),1)])])):Object(a["createCommentVNode"])("",!0),e.metadata.has_entries?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",gn,[Fn,Object(a["createElementVNode"])("div",En,[Object(a["createElementVNode"])("span",Nn,Object(a["toDisplayString"])(e.translate("Funnels_Entries")),1)])])):Object(a["createCommentVNode"])("",!0),e.metadata.has_skipped?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",yn,[kn,Object(a["createElementVNode"])("div",Vn,[Object(a["createElementVNode"])("span",Sn,Object(a["toDisplayString"])(e.translate("Funnels_Skips")),1)])])):Object(a["createCommentVNode"])("",!0),e.metadata.has_exits?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",_n,[wn,Object(a["createElementVNode"])("div",Bn,[Object(a["createElementVNode"])("span",Cn,Object(a["toDisplayString"])(e.translate("Funnels_DropOff")),1)])])):Object(a["createCommentVNode"])("",!0)]))])):Object(a["createCommentVNode"])("",!0)]),e.getFunnelSteps.length?(Object(a["openBlock"])(),Object(a["createElementBlock"])("table",Tn,[Object(a["createElementVNode"])("thead",null,[Object(a["createElementVNode"])("tr",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.metadata.steps,(function(t,n){return Object(a["openBlock"])(),Object(a["createElementBlock"])("th",{key:t},[Object(a["createElementVNode"])("div",xn,Object(a["toDisplayString"])(e.translate("Funnels_Step"))+" "+Object(a["toDisplayString"])(n+1),1),Object(a["createElementVNode"])("div",Mn,Object(a["toDisplayString"])(t),1)])})),128))])]),Object(a["createElementVNode"])("tbody",null,[Object(a["createElementVNode"])("tr",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.getFunnelSteps,(function(t,n){return Object(a["openBlock"])(),Object(a["createElementBlock"])("td",{key:n},[Object(a["createElementVNode"])("div",Ln,Object(a["toDisplayString"])(e.translate("General_ColumnNbVisits")),1),Object(a["createElementVNode"])("div",Dn,Object(a["toDisplayString"])(e.formatAbbr(e.getFirstSegmentStep(n).step_nb_visits)),1),Object(a["createElementVNode"])("div",Gn,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(t,(function(t,l){return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:l,class:"barStepContainer"},[Object(a["createElementVNode"])("div",Rn,[Object(a["createElementVNode"])("div",{class:"barProceeded",style:Object(a["normalizeStyle"])({height:e.getBarHeight("proceeded",n,t)}),onMouseenter:function(o){return e.handleTooltip(o,l,n,t,"proceeded","show")},onMousemove:function(o){return e.handleTooltip(o,l,n,t,"proceeded","move")},onMouseleave:function(o){return e.handleTooltip(o,l,n,t,"proceeded","hide")}},null,44,An),Object(a["createElementVNode"])("div",{class:"barEntries",style:Object(a["normalizeStyle"])("0%"===e.getBarHeight("entries",n,t)?{display:"none"}:{height:e.getBarHeight("entries",n,t)}),onMouseenter:function(o){return e.handleTooltip(o,l,n,t,"entries","show")},onMousemove:function(o){return e.handleTooltip(o,l,n,t,"entries","move")},onMouseleave:function(o){return e.handleTooltip(o,l,n,t,"entries","hide")}},null,44,Un),Object(a["createElementVNode"])("div",{class:"barSkipped",style:Object(a["normalizeStyle"])("0%"===e.getBarHeight("skipped",n,t)?{display:"none"}:{height:e.getBarHeight("skipped",n,t)}),onMouseenter:function(o){return e.handleTooltip(o,l,n,t,"skipped","show")},onMousemove:function(o){return e.handleTooltip(o,l,n,t,"skipped","move")},onMouseleave:function(o){return e.handleTooltip(o,l,n,t,"skipped","hide")}},null,44,Hn),Object(a["createElementVNode"])("div",{class:"barExits",style:Object(a["normalizeStyle"])("0%"===e.getBarHeight("exits",n,t)?{display:"none"}:{height:e.getBarHeight("exits",n,t)}),onMouseenter:function(o){return e.handleTooltip(o,l,n,t,"exits","show")},onMousemove:function(o){return e.handleTooltip(o,l,n,t,"exits","move")},onMouseleave:function(o){return e.handleTooltip(o,l,n,t,"exits","hide")}},null,44,qn)])])})),128))])])})),128))]),Object(a["createElementVNode"])("tr",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.getFunnelSteps,(function(t,n){return Object(a["openBlock"])(),Object(a["createElementBlock"])("td",{key:n},[Object(a["createElementVNode"])("div",Pn,Object(a["toDisplayString"])(e.getBottomLabel(e.getFunnelSteps.length===n+1)),1),Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(e.getMetricValueClasses(e.getFunnelSteps.length===n+1))},[Object(a["createElementVNode"])("span",In,Object(a["toDisplayString"])(e.formatAbbr(e.getBottomMetric(n,e.getFirstSegmentStep(n)))),1),Object(a["createElementVNode"])("span",zn," ("+Object(a["toDisplayString"])(e.getBottomRate(n,e.getFirstSegmentStep(n)))+") ",1)],2)])})),128))])])])):(Object(a["openBlock"])(),Object(a["createElementBlock"])("p",$n,[Object(a["createElementVNode"])("strong",null,Object(a["toDisplayString"])(e.translate("CoreHome_ThereIsNoDataForThisReport")),1),Wn,Object(a["createElementVNode"])("span",null,Object(a["toDisplayString"])(e.translate("Funnels_FunnelReportNotGeneratedYet")),1)]))]})),_:1}),Object(a["createVNode"])(c,{ref:"tooltip",title:e.tooltipTitle,subtitle:e.tooltipSubtitle,exits:e.tooltipExits,skipped:e.tooltipSkipped,entries:e.tooltipEntries,proceeded:e.tooltipProceeded,type:e.tooltipType},null,8,["title","subtitle","exits","skipped","entries","proceeded","type"])])}var Xn={class:"tooltip-item title"},Kn={class:"tooltip-item subtitle"},Jn={class:"tooltip-label"},Qn={class:"tooltip-value"},Zn={class:"tooltip-label"},el={class:"tooltip-value"},tl={class:"tooltip-label"},nl={class:"tooltip-value"},ll={class:"tooltip-label"},ol={class:"tooltip-value"};function al(e,t,n,l,o,i){return Object(a["withDirectives"])((Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{ref:"tooltipRef",class:"tooltip",style:Object(a["normalizeStyle"])(e.tooltipStyle)},[Object(a["createElementVNode"])("div",Xn,Object(a["toDisplayString"])(e.title),1),Object(a["createElementVNode"])("div",Kn,Object(a["toDisplayString"])(e.subtitle),1),Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(["tooltip-item",{selected:"exits"===e.type}])},[Object(a["createElementVNode"])("span",Jn,Object(a["toDisplayString"])(e.translate("Funnels_DropOff")),1),Object(a["createElementVNode"])("span",Qn,Object(a["toDisplayString"])(e.formatNumber(e.exits)),1)],2),Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(["tooltip-item",{selected:"skipped"===e.type}])},[Object(a["createElementVNode"])("span",Zn,Object(a["toDisplayString"])(e.translate("Funnels_Skips")),1),Object(a["createElementVNode"])("span",el,Object(a["toDisplayString"])(e.formatNumber(e.skipped)),1)],2),Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(["tooltip-item",{selected:"entries"===e.type}])},[Object(a["createElementVNode"])("span",tl,Object(a["toDisplayString"])(e.translate("Funnels_Entries")),1),Object(a["createElementVNode"])("span",nl,Object(a["toDisplayString"])(e.formatNumber(e.entries)),1)],2),Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(["tooltip-item",{selected:"proceeded"===e.type}])},[Object(a["createElementVNode"])("span",ll,Object(a["toDisplayString"])(e.translate("Funnels_Progressions")),1),Object(a["createElementVNode"])("span",ol,Object(a["toDisplayString"])(e.formatNumber(e.proceeded)),1)],2)],4)),[[a["vShow"],e.visible]])}var il=n("6ec9"),rl=Object(a["defineComponent"])({props:{title:{type:String,required:!0},subtitle:{type:String,required:!0},exits:{type:Number,required:!0},skipped:{type:Number,required:!0},entries:{type:Number,required:!0},proceeded:{type:Number,required:!0},type:{type:String,required:!0}},setup:function(){var e=Object(a["reactive"])({visible:!1,position:{top:0,left:0}}),t=Object(a["ref"])(null),n=Object(a["computed"])((function(){return{top:"".concat(e.position.top,"px"),left:"".concat(e.position.left,"px"),position:"absolute",zIndex:1e3}}));function l(n){var l=window.scrollY||document.documentElement.scrollTop,o=window.scrollX||document.documentElement.scrollLeft;e.position.top=n.clientY+l+10,e.position.left=n.clientX+o+10,e.visible=!0,Object(a["nextTick"])((function(){var a=t.value;if(a){var i=window,r=i.innerWidth,s=i.innerHeight,c=a.getBoundingClientRect();c.right>r&&(e.position.left=n.clientX+o-c.width-10),c.bottom>s&&(e.position.top=n.clientY+l-c.height-10);var u=a.getBoundingClientRect();u.left<0&&(e.position.left=o+10),u.top<0&&(e.position.top=l+10)}}))}function o(){e.visible=!1}return Object.assign(Object.assign({},Object(a["toRefs"])(e)),{},{tooltipRef:t,show:l,hide:o,tooltipStyle:n,translate:W["translate"],formatNumber:il["formatNumber"]})}});rl.render=al;var sl=rl,cl=Object(a["defineComponent"])({props:{metadata:{type:Object,required:!0},firstSegmentFlow:{type:Array,required:!0},funnelFlow:{type:Array,required:!0},isClosedFunnel:{type:Boolean,default:!1}},components:{EnrichedHeadline:W["EnrichedHeadline"],ContentBlock:W["ContentBlock"],Tooltip:sl},setup:function(){var e=Object(a["ref"])(null);return{tooltip:e,formatAbbr:il["formatAbbr"]}},mounted:function(){0},data:function(){return{tooltipTitle:"",tooltipSubtitle:"",tooltipExits:0,tooltipSkipped:0,tooltipEntries:0,tooltipProceeded:0,tooltipType:""}},methods:{getFirstSegmentStep:function(e){return this.firstSegmentFlow[e]||{}},translateNumericPlaceholder:function(e,t){return Object(W["translate"])(e,t||0)},getBarHeight:function(e,t,n){if(null===n)return"0%";var l={empty:n.bar_height_empty,exits:n.bar_height_exits,skipped:n.bar_height_skipped,entries:0===t?0:n.bar_height_entries,proceeded:0===t?n.bar_height_entries:n.bar_height_proceeded};return"".concat(l[e]||0,"%")},setTooltipData:function(e,t,n,l){var o=this.parseSegmentKey(e),a=o.title,i=o.period;this.tooltipTitle=a,this.tooltipSubtitle=i,this.tooltipExits=n.step_nb_previous_exits||0,this.tooltipSkipped=n.step_nb_skipped||0,this.tooltipEntries=n.step_nb_entries||0,this.tooltipProceeded=n.step_nb_previous_proceeded||0,this.tooltipType=0===t&&"proceeded"===l?"entries":l},parseLegendText:function(e){var t=this.parseSegmentKey(e),n=t.title,l=t.period;return{title:n,subtitle:l,hover:"".concat(n," (").concat(l,")")}},parseSegmentKey:function(e){var t=String(e),n=t.split("~|~"),l=n[0],o=n[1];return{title:l,period:o}},getBottomLabel:function(e){return e?Object(W["translate"])("Funnels_FunnelConversion"):Object(W["translate"])("Funnels_Exits")},getBottomMetric:function(e,t){return this.getFunnelSteps.length===e+1?t.step_nb_visits:t.step_nb_exits},getBottomRate:function(e,t){return this.getFunnelSteps.length===e+1?t.conversion_rate:t.step_rate_exits},getMetricValueClasses:function(e){var t="metricValues";return e&&(t+=" conversionMetrics"),t},handleTooltip:function(e,t,n,l,o,a){this.tooltip&&("show"===a?(this.setTooltipData(t,n,l,o),this.tooltip.show(e)):"move"===a?this.tooltip.show(e):this.tooltip.hide())}},computed:{getFunnelSteps:function(){return this.funnelFlow},getFunnelReportHelpText:function(){var e=Object(W["translate"])("Funnels_FunnelReportHelp"),t=Object(W["translate"])("Funnels_FunnelReportHelpOpenFunnel"),n="".concat(e," ").concat(t);return this.isClosedFunnel&&(t=Object(W["translate"])("Funnels_FunnelReportHelpClosedFunnel"),n="".concat(e," ").concat(t)),n},columnsPerRow:function(){var e=Object.keys(this.metadata.segments).length;return Math.ceil(e/2)}}});cl.render=Yn;var ul=cl;
/**
 * Copyright (C) InnoCraft Ltd - All rights reserved.
 *
 * NOTICE:  All information contained herein is, and remains the property of InnoCraft Ltd.
 * The intellectual and technical concepts contained herein are protected by trade secret
 * or copyright law. Redistribution of this information or reproduction of this material is
 * strictly forbidden unless prior written permission is obtained from InnoCraft Ltd.
 *
 * You shall use this code only in accordance with the license agreement obtained from
 * InnoCraft Ltd.
 *
 * @link https://www.innocraft.com/
 * @license For license details see https://www.innocraft.com/license
 */}})}));
//# sourceMappingURL=Funnels.umd.min.js.map